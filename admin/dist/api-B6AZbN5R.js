function f(){let t=window.YOLANDI_BOOT&&window.YOLANDI_BOOT.restBase||"";if(!t){const e=document.querySelector('link[rel="https://api.w.org"]');e?.href&&(t=e.href.replace(/\/$/,"")+"/yolandi/v1")}return t||(t="/wp-json/yolandi/v1"),t.replace(/\/$/,"")}async function d(t,e={}){const n={credentials:"omit",...e,headers:{"Content-Type":"application/json"}};n.body&&typeof n.body!="string"&&!(n.body instanceof FormData)&&(n.body=JSON.stringify(n.body));const s=await fetch(t,n),o=await s.text(),r=(s.headers.get("content-type")||"").includes("application/json"),l=r?o?JSON.parse(o):null:o;return{resp:s,isJson:r,body:l,text:o}}async function b(t,e={}){const a=f(),n=t.startsWith("/")?t:`/${t}`,s=`${a}${n}`,o={...e};o.body!=null&&typeof o.body!="string"&&!(o.body instanceof FormData)&&(o.body=JSON.stringify(o.body));let{resp:r,isJson:l,body:c}=await d(s,o);const u=typeof c=="string"&&c.trim().startsWith("<!DOCTYPE");if((!r.ok||u)&&!o.__fallbackTried){const i=`${s.replace(a,"")}`.replace(/^\//,""),p=`${window.location.origin}/index.php?rest_route=/yolandi/v1/${i}`,y=await d(p,{...o,__fallbackTried:!0});r=y.resp,l=y.isJson,c=y.body}if(!r.ok){const i=new Error(`API ${r.status} ${r.statusText}`);throw i.status=r.status,i.url=r.url,i.body=c,i}if(!l||c==null){const i=new Error("API returned non-JSON response");throw i.url=r.url,i.body=c,i}return c}async function w(t,e=15e3,a={}){const n=new AbortController,s=setTimeout(()=>n.abort(),e);try{return await b(t,{...a,signal:n.signal})}finally{clearTimeout(s)}}function g(t,e){const a=f(),n=new URL(String(a).replace(/\/$/,"")+"/"+String(t).replace(/^\//,""),window.location.origin);if(e&&typeof e=="object")for(const[s,o]of Object.entries(e))n.searchParams.set(s,String(o));return n.toString()}export{b as api,w as apiWithTimeout,f as computeRestBase,g as joinRest};
