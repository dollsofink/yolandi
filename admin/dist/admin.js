const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/vendor-Cu9HgnO8.js","chunks/vendor-react-Bifdz3QC.js","chunks/index-COnHatJ4.js","chunks/NodeTree-CX6rf2z9.js","chunks/index-BIJwCuMh.js","chunks/index-FIUVNo2M.js"])))=>i.map(i=>d[i]);
import{a as u,j as e}from"./chunks/vendor-react-Bifdz3QC.js";import{W as Se,a as ke,b as Ee,c as Oe,d as Ce,_ as H,e as Me}from"./chunks/vendor-Cu9HgnO8.js";function xe(){const a=(window.location.hash||"").replace(/^#\/?/,""),[i,...l]=a.split("/");return{key:i||"",rest:l.join("/")}}function Pe(a,i=""){const l=u.useMemo(()=>a.reduce((d,g)=>(d[g.key]=g,d),{}),[a]),[f,c]=u.useState(()=>{const{key:d}=xe();return l[d]?d:i});u.useEffect(()=>{const d=()=>{const{key:g}=xe();c(l[g]?g:i)};return window.addEventListener("hashchange",d),()=>window.removeEventListener("hashchange",d)},[l,i]);const p=d=>{l[d]&&xe().key!==d&&(window.location.hash=`#/${d}`)};return{routeKey:f,active:l[f],navigate:p}}const we=window.YOLANDI_CONFIG||{},je=window.location.origin.replace(/\/$/,""),Ye=[(we.restRoot||"").replace(/\/$/,""),(we.restRootQuery||"").replace(/\/$/,""),`${je}/index.php?rest_route=/yolandi/v1`,`${je}/wp-json/yolandi/v1`].filter(Boolean);Ye[0];function We(){let a=window.YOLANDI_BOOT&&window.YOLANDI_BOOT.restBase||"";if(!a){const i=document.querySelector('link[rel="https://api.w.org"]');i!=null&&i.href&&(a=i.href.replace(/\/$/,"")+"/yolandi/v1")}return a||(a="/wp-json/yolandi/v1"),a.replace(/\/$/,"")}async function ve(a,i={}){var m,x;const l={"Content-Type":"application/json","X-WP-Nonce":((m=window==null?void 0:window.YOLANDI_BOOT)==null?void 0:m.nonce)||((x=window==null?void 0:window.wpApiSettings)==null?void 0:x.nonce)||"",...i.headers||{}},f={credentials:"same-origin",...i,headers:l};f.body&&typeof f.body!="string"&&!(f.body instanceof FormData)&&(f.body=JSON.stringify(f.body));const c=await fetch(a,f),p=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),g=d?p?JSON.parse(p):null:p;return{resp:c,isJson:d,body:g,text:p}}async function ge(a,i={}){const l=We(),f=a.startsWith("/")?a:`/${a}`,c=`${l}${f}`,p={...i};p.body!=null&&typeof p.body!="string"&&!(p.body instanceof FormData)&&(p.body=JSON.stringify(p.body));let{resp:d,isJson:g,body:m}=await ve(c,p);const x=typeof m=="string"&&m.trim().startsWith("<!DOCTYPE");if((!d.ok||x)&&!p.__fallbackTried){const y=`${c.replace(l,"")}`.replace(/^\//,""),w=`${window.location.origin}/index.php?rest_route=/yolandi/v1/${y}`,j=await ve(w,{...p,__fallbackTried:!0});d=j.resp,g=j.isJson,m=j.body}if(!d.ok){const y=new Error(`API ${d.status} ${d.statusText}`);throw y.status=d.status,y.url=d.url,y.body=m,y}if(!g||m==null){const y=new Error("API returned non-JSON response");throw y.url=d.url,y.body=m,y}return m}self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(a,i){switch(i){case"json":return new Ce;case"css":return new Oe;case"html":return new Ee;case"typescript":case"javascript":return new ke;default:return new Se}}});async function Je(){const a=await H(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.m),__vite__mapDeps([0,1]));return await Promise.all([H(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.f),__vite__mapDeps([0,1])),H(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.g),__vite__mapDeps([0,1])),H(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.h),__vite__mapDeps([0,1])),H(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.i),__vite__mapDeps([0,1]))]),a}function Fe(a="{}"){const i=u.useRef(null),[l,f]=u.useState(a);return u.useEffect(()=>{let c;return(async()=>{try{c=(await Je()).editor.create(i.current,{value:a,language:"json",automaticLayout:!0,minimap:{enabled:!1}}),c.onDidChangeModelContent(()=>f(c.getValue()))}catch{if(i.current){const p=document.createElement("textarea");p.value=a,p.style.width="100%",p.style.height="260px",p.addEventListener("input",()=>f(p.value)),i.current.appendChild(p)}}})(),()=>{var p;return(p=c==null?void 0:c.dispose)==null?void 0:p.call(c)}},[]),[i,l,f]}function Be(){const[a,i]=u.useState("example-search"),[l,f]=u.useState(1),[c,p]=u.useState('{ "q": "hello" }'),[d,g]=Fe(`{
  "nodes": [
    { "id": "n1", "type": "SetDevice", "props": { "profile": "Pixel7" } },
    { "id": "n2", "type": "ProxyDirector", "props": { "director": "webshare-main", "sessionSeed": "\${jobId}" } },
    { "id": "n3", "type": "Navigate", "props": { "url": "https://example.com" } },
    { "id": "n4", "type": "Screenshot", "props": { "path": "\${artifacts}/shot.png", "fullPage": true } }
  ],
  "edges": [ { "from": "n1", "to": "n2" }, { "from": "n2", "to": "n3" }, { "from": "n3", "to": "n4" } ],
  "meta": { "slug": "example-search", "version": 1 }
}`);async function m(){let x;try{x=JSON.parse(g)}catch{alert("Invalid JSON graph");return}const y={script_slug:a,script_version:Number(l),params:JSON.parse(c||"{}"),priority:5},w=await ge("/jobs/enqueue",{method:"POST",body:y});w!=null&&w.id?alert(`Enqueued Job #${w.id}`):alert("Failed to enqueue")}return e.jsxs("div",{children:[e.jsx("h2",{children:"Script JSON"}),e.jsx("div",{ref:d,style:{border:"1px solid #ccd0d4",height:280}}),e.jsx("h3",{style:{marginTop:16},children:"Run Parameters"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Slug: ",e.jsx("input",{value:a,onChange:x=>i(x.target.value)})]}),e.jsxs("label",{children:["Version: ",e.jsx("input",{type:"number",min:1,value:l,onChange:x=>f(x.target.value),style:{width:80}})]})]}),e.jsx("textarea",{value:c,onChange:x=>p(x.target.value),style:{width:"100%",height:120,marginTop:8}}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("button",{className:"button button-primary",onClick:m,children:"Enqueue Test Run"}),e.jsxs("span",{style:{marginLeft:8,color:"#555"},children:["Posts to ",e.jsx("code",{children:"/jobs/enqueue"}),". Save graphs under ",e.jsx("code",{children:"scripts/<slug>/vNNN.json"}),"."]})]})]})}function qe(){const[a,i]=u.useState(0),[l,f]=u.useState(null),[c,p]=u.useState(!1);async function d(){if(!a)return;p(!0);const g=await ge(`/jobs/${a}`);f(g||null),p(!1)}return e.jsxs("div",{children:[e.jsx("h2",{children:"Jobs"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Job ID: ",e.jsx("input",{type:"number",value:a,onChange:g=>i(Number(g.target.value))})]}),e.jsx("button",{className:"button",onClick:d,children:"Load"})]}),c?e.jsx("p",{children:"Loading…"}):null,l?e.jsxs("div",{style:{marginTop:12},children:[e.jsx("table",{className:"widefat fixed striped",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("td",{children:l.id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("td",{children:l.status})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Script"}),e.jsxs("td",{children:[l.script_slug," v",l.script_version]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Attempts"}),e.jsxs("td",{children:[l.attempts," / ",l.max_attempts]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Runner"}),e.jsx("td",{children:l.runner_id||""})]})]})}),l.artifacts?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Artifacts"}),e.jsx("pre",{style:{background:"#f6f7f7",padding:8,whiteSpace:"pre-wrap"},children:JSON.stringify(l.artifacts,null,2)})]}):null,l.error?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Error"}),e.jsx("pre",{style:{background:"#fff4f4",padding:8,color:"#a00"},children:JSON.stringify(l.error,null,2)})]}):null]}):null]})}function He(){const[a,i]=u.useState([]),[l,f]=u.useState(!1),[c,p]=u.useState("");return u.useEffect(()=>{let d=!0;return f(!0),ge("/nodes").then(g=>{d&&(Array.isArray(g)?i(g):p(String(g||"")))}).finally(()=>d&&f(!1)),()=>d=!1},[]),e.jsxs("div",{children:[e.jsx("h2",{children:"Nodes"}),l?e.jsx("p",{children:"Loading…"}):null,c&&e.jsx("p",{style:{color:"#a00"},children:c}),e.jsxs("table",{className:"widefat fixed striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Version"})]})}),e.jsx("tbody",{children:a.map(d=>{var g,m,x,y;return e.jsxs("tr",{children:[e.jsx("td",{children:d.path}),e.jsx("td",{children:((g=d.meta)==null?void 0:g.type)||"?"}),e.jsx("td",{children:((m=d.meta)==null?void 0:m.title)||""}),e.jsx("td",{children:((x=d.meta)==null?void 0:x.category)||""}),e.jsx("td",{children:((y=d.meta)==null?void 0:y.version)||""})]},d.path)})})]}),e.jsxs("p",{style:{marginTop:8},children:["Add custom nodes by dropping ",e.jsx("code",{children:".mjs"})," files into"," ",e.jsx("code",{children:"wp-content/plugins/yolandi/nodes/"}),", then reload this page."]})]})}const be=()=>Math.random().toString(36).slice(2,9);function ze({registerApi:a}){function i(s,t,n){return`${s}:${t}:${n}`}function l(s,t,n){const o=document.querySelector(`[data-port-key="${i(s,t,n)}"] .dot`)||document.querySelector(`[data-port-key="${i(s,t,n)}"]`);if(!o)return null;const r=o.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top+r.height/2}}const f=280,c=28,p=22,d=u.useRef(null),g=u.useRef(null),[m,x]=u.useState([]),[y,w]=u.useState([]),[j,k]=u.useState({x:0,y:0,k:1}),[O,T]=u.useState("select"),[E,C]=u.useState(null),[N,L]=u.useState(null),[_,X]=u.useState(null),V=.3,Z=2,Y=u.useRef(new Set),I=()=>{for(const s of Y.current)try{s()}catch{}};u.useEffect(()=>{I()},[m,y,j]);const D=(s,t)=>{const n=d.current.getBoundingClientRect();return{x:(s-n.left-j.x)/j.k,y:(t-n.top-j.y)/j.k}},Q=s=>m.find(t=>t.id===s);u.useEffect(()=>{const s={addNodeByMeta(t,n){var R,P,de;const{x:o,y:r}=D(n.x,n.y),h="n"+be(),b=(t==null?void 0:t.title)||(t==null?void 0:t.type)||"Node",S=(t==null?void 0:t.props)||{},v={};for(const[F,B]of Object.entries(S))v[F]=(R=B==null?void 0:B.default)!=null?R:"";const $=(((P=t==null?void 0:t.io)==null?void 0:P.inputs)||["in"]).map((F,B)=>({id:"i"+B,name:F})),A=(((de=t==null?void 0:t.io)==null?void 0:de.outputs)||["out"]).map((F,B)=>({id:"o"+B,name:F}));x(F=>[...F,{id:h,x:Math.round(o-f/2),y:Math.round(r-16),w:f,title:b,meta:t,fields:v,inputs:$,outputs:A,selected:!1}])},exportJSON(){return{version:1,view:{x:j.x,y:j.y,k:j.k},nodes:m.map(t=>{var n;return{id:t.id,title:t.title,type:((n=t.meta)==null?void 0:n.type)||null,x:t.x,y:t.y,w:t.w,fields:t.fields,inputs:t.inputs,outputs:t.outputs}}),links:y}},importJSON(t){!t||!Array.isArray(t.nodes)||(k(t.view||{x:0,y:0,k:1}),x(t.nodes.map(n=>({id:n.id,title:n.title||"Node",meta:{type:n.type||"Imported"},x:n.x,y:n.y,w:n.w||f,fields:n.fields||{},inputs:n.inputs||[{id:"i0",name:"in"}],outputs:n.outputs||[{id:"o0",name:"out"}],selected:!1}))),w(Array.isArray(t.links)?t.links:[]))},setMode:T,getZoom(){return j.k},getPan(){return{x:j.x,y:j.y}},getView(){return{zoom:j.k,pan:{x:j.x,y:j.y}}},setZoom(t){ie(t,U())},setPan(t){k(n=>{var o,r;return{...n,x:(o=t==null?void 0:t.x)!=null?o:n.x,y:(r=t==null?void 0:t.y)!=null?r:n.y}})},panTo(t){k(n=>{var o,r;return{...n,x:(o=t==null?void 0:t.x)!=null?o:n.x,y:(r=t==null?void 0:t.y)!=null?r:n.y}})},setView(t){t&&(typeof t.zoom=="number"&&s.setZoom(t.zoom),t.pan&&s.setPan(t.pan))},showAll:J,fit:J,fitToScreen:J,fitView:J,viewAll:J,zoomFit:J,zoomIn(){W(1.1,U())},zoomOut(){W(.9090909090909091,U())},onChange:{subscribe(t){return typeof t!="function"?()=>{}:(Y.current.add(t),()=>Y.current.delete(t))}}};a==null||a(s),window.YOLANDI=window.YOLANDI||{},window.YOLANDI.exportWorkflow=()=>s.exportJSON(),window.YOLANDI.importWorkflow=t=>s.importJSON(t)},[m,y,j,a]);const G=(s,t,n)=>{const o=l(s,t,n);if(!o)return null;const r=d.current.getBoundingClientRect();return{x:(o.x-r.left-j.x)/j.k,y:(o.y-r.top-j.y)/j.k}},[M,z]=u.useState([]),K=u.useRef({a:0,b:0});function oe(){const s=[];for(const t of y){const n=G("out",t.from.nid,t.from.pid),o=G("in",t.to.nid,t.to.pid);if(!n||!o)continue;const r=Math.max(40,Math.abs(o.x-n.x)*.6);s.push({id:t.id,d:`M ${n.x},${n.y} C ${n.x+r},${n.y} ${o.x-r},${o.y} ${o.x},${o.y}`})}if(N){const t=G("out",N.from.nid,N.from.pid),n=D(N.x,N.y);if(t&&n){const o=Math.max(40,Math.abs(n.x-t.x)*.6);s.push({id:"_wip",d:`M ${t.x},${t.y} C ${t.x+o},${t.y} ${n.x-o},${n.y} ${n.x},${n.y}`})}}return s}function ee(){const s=K.current;s.a&&cancelAnimationFrame(s.a),s.b&&cancelAnimationFrame(s.b),s.a=requestAnimationFrame(()=>{s.b=requestAnimationFrame(()=>z(oe()))})}u.useEffect(()=>{ee()},[m,y,N,j]),u.useEffect(()=>{const s=()=>ee();return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s);const{a:t,b:n}=K.current;t&&cancelAnimationFrame(t),n&&cancelAnimationFrame(n)}},[]);function U(){const s=d.current.getBoundingClientRect();return{x:s.left+s.width/2,y:s.top+s.height/2}}function ie(s,t){k(n=>{const o=Math.min(Z,Math.max(V,s));if(!t)return{...n,k:o};const r=d.current.getBoundingClientRect(),h=(t.x-r.left-n.x)/n.k,b=(t.y-r.top-n.y)/n.k,S=t.x-r.left-h*o,v=t.y-r.top-b*o;return{x:S,y:v,k:o}})}function W(s,t){k(n=>{const o=Math.min(Z,Math.max(V,n.k*s)),r=d.current.getBoundingClientRect();if(!t)return{...n,k:o};const h=(t.x-r.left-n.x)/n.k,b=(t.y-r.top-n.y)/n.k,S=t.x-r.left-h*o,v=t.y-r.top-b*o;return{x:S,y:v,k:o}})}u.useEffect(()=>{const s=d.current;if(!s)return;const t=n=>{n.ctrlKey?(n.preventDefault(),W(n.deltaY<0?1.1:1/1.1,{x:n.clientX,y:n.clientY})):O==="pan"&&(n.preventDefault(),k(o=>({...o,x:o.x-n.deltaX,y:o.y-n.deltaY})))};return s.addEventListener("wheel",t,{passive:!1}),()=>s.removeEventListener("wheel",t)},[O]);function te(s){var h,b,S,v;if((b=(h=s.target).closest)!=null&&b.call(h,".yc-node")||(v=(S=s.target).closest)!=null&&v.call(S,".yc-port"))return;if(O==="pan"||s.button===1){const $={sx:s.clientX,sy:s.clientY,vx:j.x,vy:j.y},A=P=>k({x:$.vx+(P.clientX-$.sx),y:$.vy+(P.clientY-$.sy),k:j.k}),R=()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",R)};window.addEventListener("mousemove",A),window.addEventListener("mouseup",R);return}const t=D(s.clientX,s.clientY);let n={sx:t.x,sy:t.y,ex:t.x,ey:t.y,sxScr:s.clientX,syScr:s.clientY,exScr:s.clientX,eyScr:s.clientY};X(n);const o=$=>{const A=D($.clientX,$.clientY);n={...n,ex:A.x,ey:A.y,exScr:$.clientX,eyScr:$.clientY},X(n);const R=Math.min(n.sx,n.ex),P=Math.min(n.sy,n.ey),de=Math.max(n.sx,n.ex),F=Math.max(n.sy,n.ey);x(B=>B.map(q=>{const Ae=c+8+Math.max(q.inputs.length,q.outputs.length)*p+12+Object.keys(q.fields).length*(p+4),Le=q.x,Ie=q.y,De=q.x+q.w,_e=q.y+Ae,Te=!(De<R||Le>de||_e<P||Ie>F);return{...q,selected:Te}}))},r=()=>{X(null),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)}function fe(s,t){s.button===0&&re(s,t)}function ae(s,t){if(s.button!==0)return;const n=s.target.tagName;["INPUT","SELECT","TEXTAREA","BUTTON"].includes(n)||s.target.closest(".yc-port")||re(s,t)}function re(s,t){if(!Q(t))return;const o=m.filter(S=>S.selected).map(S=>S.id),r=o.length?o:[t],h=D(s.clientX,s.clientY),b=r.map(S=>{const v=Q(S);return{id:S,dx:h.x-v.x,dy:h.y-v.y}});C({ids:r,offsets:b}),s.stopPropagation()}u.useEffect(()=>{const s=n=>{if(!E)return;const o=D(n.clientX,n.clientY);x(r=>r.map(h=>{const b=E.offsets.find(S=>S.id===h.id);return b?{...h,x:Math.round(o.x-b.dx),y:Math.round(o.y-b.dy)}:h}))},t=()=>C(null);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",t)}},[E]);function le(s,t,n){const o=document.querySelector(`[data-port-key="out:${s}:${t}"] .dot`);if(!o)return;const r=o.getBoundingClientRect();L({from:{nid:s,pid:t},x:r.left+r.width/2,y:r.top+r.height/2}),n.stopPropagation()}function ce(s){N&&L(t=>({...t,x:s.clientX,y:s.clientY}))}function ne(s,t){const n=Array.from(document.querySelectorAll(".yc-port.in"));let o=null,r=256;for(const h of n){const b=h.getAttribute("data-port-key"),[,S,v]=b.split(":"),$=G("in",S,v);if(!$)continue;const A=$.x-s,R=$.y-t,P=A*A+R*R;P<r&&(r=P,o={nid:S,pid:v})}return o}function me(s,t,n){if(!N)return;if(!s||!t){const h=D(n.clientX,n.clientY),b=ne(h.x,h.y);b&&(s=b.nid,t=b.pid)}if(!s||!t){L(null);return}const r={id:"l"+be(),from:N.from,to:{nid:s,pid:t}};w(h=>[...h.filter(b=>!(b.to.nid===s&&b.to.pid===t)),r]),L(null),n.stopPropagation()}function he(){N&&L(null)}function J(){if(!m.length){k({x:0,y:0,k:1});return}const s=60;let t=1/0,n=1/0,o=-1/0,r=-1/0;for(const R of m){const P=c+8+Math.max(R.inputs.length,R.outputs.length)*p+12+Object.keys(R.fields).length*(p+4);t=Math.min(t,R.x),o=Math.max(o,R.x+R.w),n=Math.min(n,R.y),r=Math.max(r,R.y+P)}const h=d.current.getBoundingClientRect(),b=h.width-s*2,S=h.height-s*2,v=Math.min(Z,Math.max(V,Math.min(b/(o-t),S/(r-n)))),$=s-t*v+(h.width-(o-t)*v-s*2)/2,A=s-n*v+(h.height-(r-n)*v-s*2)/2;k({x:$,y:A,k:v})}return e.jsxs("div",{id:"yc-canvas",ref:d,style:{position:"absolute",inset:0},onMouseMove:ce,onMouseUp:he,onMouseDown:te,onDragOver:s=>{var t,n;(n=(t=s.dataTransfer)==null?void 0:t.types)!=null&&n.includes("application/x-yolandi-node")&&(s.preventDefault(),s.dataTransfer.dropEffect="copy")},onDrop:s=>{var o,r,h;const t=(o=s.dataTransfer)==null?void 0:o.getData("application/x-yolandi-node");if(!t)return;s.preventDefault(),s.stopPropagation();const n=JSON.parse(t);(h=(r=window.YOLANDI.actions).onNodeDrop)==null||h.call(r,n,{x:s.clientX,y:s.clientY})},children:[e.jsxs("div",{className:"yc-toolbar",style:{position:"absolute",right:12,top:8,zIndex:20,display:"flex",gap:6,alignItems:"center"},children:[e.jsx("button",{title:"Pan",onClick:()=>T(s=>s==="pan"?"select":"pan"),children:e.jsx("i",{className:"fa fa-hand"})}),e.jsx("span",{className:"sep"}),e.jsx("button",{title:"Zoom Out",onClick:()=>W(1/1.1,U()),children:e.jsx("i",{className:"fa fa-magnifying-glass-minus"})}),e.jsxs("span",{className:"zoom",children:[" ",j.k*100|0,"%"]}),e.jsx("button",{title:"Zoom In",onClick:()=>W(1.1,U()),children:e.jsx("i",{className:"fa fa-magnifying-glass-plus"})}),e.jsx("button",{title:"Show Entire Workspace",onClick:J,children:e.jsx("i",{className:"fa fa-rectangle-list"})})]}),e.jsxs("div",{ref:g,className:"yc-content",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",transformOrigin:"0 0",transform:`translate(${j.x}px, ${j.y}px) scale(${j.k})`},children:[e.jsx("svg",{className:"yc-wires",width:"20000",height:"12000",style:{position:"absolute",left:0,top:0,overflow:"visible",pointerEvents:"none",zIndex:0},children:M.map(s=>e.jsx("path",{d:s.d,className:s.id==="_wip"?"yc-wire wip":"yc-wire",stroke:s.id==="_wip"?"rgba(96,165,250,.7)":"rgba(96,165,250,.95)",strokeWidth:2,fill:"none",style:{vectorEffect:"non-scaling-stroke"}},s.id))}),m.map(s=>e.jsxs("div",{className:`yc-node ${s.selected?"selected":""}`,style:{left:s.x,top:s.y,width:s.w,position:"absolute",zIndex:1},onMouseDown:t=>ae(t,s.id),children:[e.jsxs("div",{className:"yc-head",onMouseDown:t=>fe(t,s.id),title:s.title,children:[e.jsx("i",{className:"fa fa-grip-lines"}),e.jsx("span",{children:s.title})]}),e.jsxs("div",{className:"yc-ports",children:[e.jsx("div",{className:"col in",children:s.inputs.map(t=>e.jsxs("div",{className:"yc-port in","data-port-key":`in:${s.id}:${t.id}`,onMouseUp:n=>me(s.id,t.id,n),children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"name",children:t.name})]},t.id))}),e.jsx("div",{className:"col out",children:s.outputs.map(t=>e.jsxs("div",{className:"yc-port out","data-port-key":`out:${s.id}:${t.id}`,onMouseDown:n=>le(s.id,t.id,n),children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"dot"})]},t.id))})]}),e.jsx("div",{className:"yc-body",children:Object.entries(s.fields).map(([t,n])=>{var b,S;const o=((S=(b=s.meta)==null?void 0:b.props)==null?void 0:S[t])||{type:"string"},r=(o.type||"string").toLowerCase(),h=v=>x($=>$.map(A=>A.id===s.id?{...A,fields:{...A.fields,[t]:v}}:A));return["bool","boolean","checkbox"].includes(r)?e.jsxs("label",{className:"row check",children:[e.jsx("input",{type:"checkbox",checked:!!n,onChange:v=>h(v.target.checked)}),e.jsx("span",{className:"lab",children:t})]},t):r==="number"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"number",value:n!=null?n:"",onChange:v=>h(v.target.value===""?"":Number(v.target.value))})]},t):r==="select"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("select",{value:n!=null?n:"",onChange:v=>h(v.target.value),children:(o.options||[]).map(v=>e.jsx("option",{value:v,children:String(v)},String(v)))})]},t):e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"text",value:n!=null?n:"",onChange:v=>h(v.target.value)})]},t)})})]},s.id))]}),_&&e.jsx("div",{className:"yc-marquee",style:{position:"fixed",border:"1px dashed rgba(96,165,250,.9)",background:"rgba(96,165,250,.12)",pointerEvents:"none",zIndex:10,left:Math.min(_.sxScr,_.exScr),top:Math.min(_.syScr,_.eyScr),width:Math.abs(_.exScr-_.sxScr),height:Math.abs(_.eyScr-_.syScr)}})]})}function Ue({isRunning:a,isPaused:i,isTerminal:l,onPlayPause:f,onStop:c,onExport:p,onImport:d,log:g}){const[m,x]=u.useState(null),y=u.useRef(null),w=u.useRef(null);u.useEffect(()=>{const C=L=>{y.current&&(y.current.contains(L.target)||x(null))},N=L=>{L.key==="Escape"&&x(null)};return document.addEventListener("mousedown",C),window.addEventListener("keydown",N),()=>{document.removeEventListener("mousedown",C),window.removeEventListener("keydown",N)}},[]);const j=C=>()=>{clearTimeout(w.current),w.current=setTimeout(()=>x(C),80)},k=()=>{clearTimeout(w.current),w.current=setTimeout(()=>x(null),150)},O=C=>N=>{N.preventDefault(),N.stopPropagation(),x(L=>L===C?null:C)},T=()=>{var C,N;(N=(C=window==null?void 0:window.YOLANDI)==null?void 0:C.actions)!=null&&N.onFileSave?(window.YOLANDI.actions.onFileSave(),x(null)):g==null||g("Save not available (GraphApp actions missing)","WARN")},E=()=>{var C,N;(N=(C=window==null?void 0:window.YOLANDI)==null?void 0:C.actions)!=null&&N.onFileSaveAs?(window.YOLANDI.actions.onFileSaveAs(),x(null)):g==null||g("Save As not available (GraphApp actions missing)","WARN")};return e.jsxs("div",{ref:y,className:"ystudio-menubar",style:{position:"relative",zIndex:50,display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderBottom:"1px solid #222",background:"#121212"},children:[e.jsxs(ye,{id:"file",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-file"})," File"]}),open:m==="file",onHoverOpen:j("file"),onHoverClose:k,onClickToggle:O("file"),children:[e.jsx(ue,{icon:"fa-save",label:"Save",onClick:T}),e.jsx(ue,{icon:"fa-file-export",label:"Save as…",onClick:E}),e.jsx(Xe,{}),e.jsx(ue,{icon:"fa-download",label:"Export (.json)",onClick:()=>{x(null),p==null||p()}}),e.jsx(ue,{icon:"fa-upload",label:"Import (.json)",onClick:()=>{x(null),d==null||d()}})]}),e.jsx(ye,{id:"nodes",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-diagram-project"})," Nodes"]}),open:m==="nodes",onHoverOpen:j("nodes"),onHoverClose:k,onClickToggle:O("nodes"),children:e.jsx("div",{className:"menu-note",children:"Drop nodes from the sidebar palette."})}),e.jsx(ye,{id:"help",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-circle-question"})," Help"]}),open:m==="help",onHoverOpen:j("help"),onHoverClose:k,onClickToggle:O("help"),children:e.jsx("div",{className:"menu-note",children:"Ctrl+S: Save  •  Ctrl+Shift+S: Save as…"})}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",title:i?"Resume":a?"Pause":"Run",onClick:f,children:i?e.jsx("i",{className:"fa fa-play"}):a?e.jsx("i",{className:"fa fa-pause"}):e.jsx("i",{className:"fa fa-play"})}),e.jsx("button",{className:"btn",title:"Stop",onClick:c,children:e.jsx("i",{className:"fa fa-stop"})})]}),e.jsx("style",{children:`
        .btn {
          background:#2b2b2b;border:1px solid #3a3a3a;border-radius:6px;
          padding:6px 10px;color:#ddd;cursor:pointer;line-height:1;
        }
        .btn:hover { background:#333; }
        .menu-root {
          position: relative;
        }
        .menu-button {
          border: none; background: transparent; color:#ddd; cursor: pointer;
          border-radius: 6px; padding:6px 10px; display:flex; align-items:center; gap:6px;
        }
        .menu-button:hover, .menu-root[aria-expanded="true"] .menu-button {
          background:#1e1e1e;
        }
        .menu-popover {
          position: absolute; top: calc(100% + 4px); left: 0;
          background:#1b1b1b; border:1px solid #333; border-radius:8px;
          min-width: 220px; padding: 6px; z-index: 200;
          box-shadow: 0 6px 24px rgba(0,0,0,0.35);
        }
        .menu-item {
          display:flex; align-items:center; gap:8px;
          width:100%; border:none; background:transparent; color:#ddd;
          padding:8px 10px; border-radius:6px; cursor:pointer; text-align:left;
        }
        .menu-item:hover { background:#2b2b2b; }
        .menu-sep { height:1px; background:#2a2a2a; margin:6px 4px; }
        .menu-note { padding:8px 10px; font-size:12px; opacity:0.8; }
      `})]})}function ye({id:a,label:i,open:l,onHoverOpen:f,onHoverClose:c,onClickToggle:p,children:d}){return e.jsxs("div",{className:"menu-root","aria-expanded":l?"true":"false",onMouseEnter:f,onMouseLeave:c,children:[e.jsxs("button",{type:"button",className:"menu-button",onClick:p,children:[i," ",e.jsx("i",{className:"fa fa-caret-down"})]}),l&&e.jsx("div",{className:"menu-popover",role:"menu","aria-labelledby":a,children:d})]})}function ue({icon:a,label:i,onClick:l}){return e.jsxs("button",{type:"button",className:"menu-item",onClick:l,children:[a?e.jsx("i",{className:`fa ${a}`}):null,e.jsx("span",{children:i})]})}function Xe(){return e.jsx("div",{className:"menu-sep","aria-hidden":"true"})}const $e=Object.assign({"../activity/loop/index.jsx":()=>H(()=>import("./chunks/index-COnHatJ4.js"),__vite__mapDeps([2,1,3])),"../activity/puppeteer/index.jsx":()=>H(()=>import("./chunks/index-BIJwCuMh.js"),__vite__mapDeps([4,1,3])),"../activity/shop/index.jsx":()=>H(()=>import("./chunks/index-FIUVNo2M.js"),__vite__mapDeps([5,1]))});console.log($e);function Ve({manifest:a,log:i,auth:l}){const[f,c]=u.useState([]);u.useEffect(()=>{let d=!1;return(async()=>{const g=[];for(const[m,x]of Object.entries($e))try{const y=await x(),w=y.meta||{},k=(y.create||(()=>({id:"x",title:"Unknown",icon:"fa-cube",render:()=>null})))({manifest:a,log:i,auth:l});g.push({id:w.id||k.id,title:w.title||k.title,icon:w.icon||k.icon,render:k.render})}catch(y){console.warn("Activity load failed",m,y)}d||c(g)})(),()=>{d=!0}},[a,i,l]);const p=u.useMemo(()=>f.length?[]:[{id:"puppeteer",title:"Puppeteer",icon:"fa-angle",render:()=>e.jsxs("div",{style:{padding:8,color:"#bbb",fontSize:12},children:["No activity plugins found. Add files under ",e.jsx("code",{children:"admin/activity/*/index.jsx"}),"."]})}],[f]);return f.length?f:p}function Ge({activePanel:a,setActivePanel:i,paletteOpen:l,setPaletteOpen:f,manifest:c,log:p,auth:d}){var x,y;const g=Ve({manifest:c,log:p,auth:d}),m=()=>f(!l);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"ystudio-activity",children:g.map(w=>e.jsx("button",{className:`activity-btn ${a===w.id?"active":""}`,title:w.title,onClick:()=>{a===w.id?m():(l||m(),i(w.id))},children:e.jsx("i",{className:`fa ${w.icon}`})},w.id))}),e.jsxs("div",{id:"ystudio-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("span",{className:"label",children:((x=g.find(w=>w.id===a))==null?void 0:x.title)||"Panel"}),e.jsx("button",{className:"icon-btn",onClick:m,title:"Toggle Sidebar",children:e.jsx("i",{className:"fa fa-spider"})})]}),e.jsx("div",{className:"palette-scroll",children:(y=g.find(w=>w.id===a))==null?void 0:y.render()})]})]})}function Ke({jobId:a,job:i,runnerCmdPS:l,runnerCmdSH:f,onPlay:c,onPause:p,onResume:d,onCancel:g}){var j;const m=u.useRef(null),x=u.useRef(null);u.useEffect(()=>{const k=x.current,O=m.current;if(!k||!O)return;let T=0,E=0;const C=_=>{T=_.clientY,E=O.getBoundingClientRect().height,document.addEventListener("mousemove",N),document.addEventListener("mouseup",L)},N=_=>{const X=T-_.clientY,V=Math.max(120,E+X);O.style.setProperty("--panel-height",`${V}px`)},L=()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",L)};return k.addEventListener("mousedown",C),()=>k.removeEventListener("mousedown",C)},[]);const y=(i==null?void 0:i.status)==="paused",w=["succeeded","failed","canceled"].includes((i==null?void 0:i.status)||"");return e.jsxs("div",{id:"ystudio-panel",ref:m,style:{"--panel-height":"220px",height:"var(--panel-height)",minHeight:120,overflow:"hidden",flex:"0 0 auto"},children:[e.jsxs("div",{id:"ystudio-panel-tabs",children:[e.jsxs("div",{className:"tab active",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Runner"]}),e.jsx("div",{className:"spacer"}),e.jsx("div",{className:"controls"})]}),e.jsx("div",{id:"ystudio-panel-body",style:{height:"calc(var(--panel-height) - 32px)",overflow:"auto"},children:e.jsxs("div",{id:"ystudio-runner",children:[e.jsxs("div",{className:"runner-help",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Windows PowerShell)"}),e.jsx("textarea",{readOnly:!0,value:l,onFocus:k=>k.target.select(),rows:3,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Linux/macOS)"}),e.jsx("textarea",{readOnly:!0,value:f,onFocus:k=>k.target.select(),rows:3,style:{width:"100%"}})]})]}),e.jsxs("div",{className:"runner-status",style:{display:"flex",gap:16,alignItems:"center",margin:"4px 0 8px"},children:[e.jsxs("span",{children:[e.jsx("b",{children:"Job:"})," ",a?`#${a}`:"—"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Status:"})," ",(i==null?void 0:i.status)||(a?"queued":"—")]}),e.jsxs("span",{children:[e.jsx("b",{children:"Runner:"})," ",(i==null?void 0:i.runner_id)||"—"]}),((j=i==null?void 0:i.error)==null?void 0:j.message)&&e.jsxs("span",{style:{color:"crimson"},children:[e.jsx("b",{children:"Error:"})," ",i.error.message]}),e.jsx("span",{className:"spacer",style:{flex:1}}),e.jsxs("button",{className:"btn",onClick:c,title:"Enqueue Workflow",children:[e.jsx("i",{className:"fa fa-play"})," Run"]}),e.jsxs("button",{className:"btn",onClick:y?d:p,disabled:!a||w,title:y?"Resume":"Pause",children:[e.jsx("i",{className:`fa fa-${y?"play":"pause"}`})," ",y?"Resume":"Pause"]}),e.jsxs("button",{className:"btn",onClick:g,disabled:!a||w,title:"Cancel",children:[e.jsx("i",{className:"fa fa-stop"})," Stop"]})]}),e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"}})]})}),e.jsx("div",{id:"ystudio-panel-drag",ref:x,title:"Resize panel"})]})}function Ze({onClose:a,onLoggedIn:i}){const[l,f]=u.useState("login"),[c,p]=u.useState({username:"",email:"",password:""}),[d,g]=u.useState("");async function m({username:w,password:j}){try{const O=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:w,password:j})})).json();if(O!=null&&O.token)return localStorage.setItem("yolandi_token",O.token),i(),!0}catch{}return!1}async function x({email:w,username:j,password:k}){try{const T=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w,username:j,password:k})})).json();if(T!=null&&T.token)return localStorage.setItem("yolandi_token",T.token),i(),!0}catch{}return!1}async function y(){(l==="login"?await m({username:c.username,password:c.password}):await x({email:c.email,username:c.username,password:c.password}))||g("Authentication failed")}return e.jsx("div",{className:"auth-mask",children:e.jsxs("div",{className:"auth-modal",children:[e.jsxs("div",{className:"head",children:[e.jsx("b",{children:"Sign in to YOLANDI.org"}),e.jsx("button",{onClick:a,children:e.jsx("i",{className:"fa fa-xmark"})})]}),e.jsxs("div",{className:"body",children:[l==="register"&&e.jsxs("label",{children:["Email ",e.jsx("input",{type:"email",value:c.email,onChange:w=>p({...c,email:w.target.value})})]}),e.jsxs("label",{children:["Username ",e.jsx("input",{value:c.username,onChange:w=>p({...c,username:w.target.value})})]}),e.jsxs("label",{children:["Password ",e.jsx("input",{type:"password",value:c.password,onChange:w=>p({...c,password:w.target.value})})]}),d&&e.jsx("div",{className:"err",children:d})]}),e.jsxs("div",{className:"foot",children:[e.jsx("button",{onClick:y,className:"primary",children:l==="login"?"Login":"Create Account"}),e.jsx("button",{onClick:()=>f(l==="login"?"register":"login"),className:"ghost",children:l==="login"?"Create an account":"Back to login"}),e.jsx("div",{className:"grow"}),e.jsx("button",{onClick:()=>{var w,j;(j=(w=window.YOLANDI)==null?void 0:w.devBypass)==null||j.call(w),i()},className:"ghost",title:"Developer bypass",children:"Bypass"})]})]})})}function Qe({initialPath:a=null,fsLs:i,onConfirm:l,onClose:f}){const[c,p]=u.useState({loading:!0,cwd:"",dirs:[],files:[],filename:"workflow.json",canUp:!1}),[d,g]=u.useState(""),m=async(x=null)=>{g(""),p(y=>({...y,loading:!0}));try{const y=await i(x||a||null);p({loading:!1,cwd:y.cwd,dirs:y.dirs||[],files:y.files||[],filename:"workflow.json",canUp:!!y.canUp})}catch(y){g(y.message||String(y)),p(w=>({...w,loading:!1}))}};return u.useEffect(()=>{m()},[]),e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{width:720,maxHeight:"80vh",background:"#151515",border:"1px solid #333",borderRadius:12,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid #2a2a2a",display:"flex",alignItems:"center",gap:10},children:[e.jsx("strong",{children:"Save workflow as…"}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsxs("button",{className:"btn",onClick:f,children:[e.jsx("i",{className:"fa fa-xmark"})," Close"]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:"1px solid #1f1f1f",display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("button",{className:"btn",disabled:!c.canUp,onClick:()=>m(c.cwd+"/.."),children:[e.jsx("i",{className:"fa fa-level-up-alt"})," Up"]}),e.jsx("div",{style:{fontFamily:"ui-monospace, Menlo, Consolas, monospace",fontSize:12,opacity:.9},children:c.cwd||"(loading…)"})]}),e.jsxs("div",{style:{display:"flex",gap:10,padding:12},children:[e.jsxs("div",{style:{flex:"0 0 45%",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Folders"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[c.loading?e.jsx("div",{style:{padding:12,opacity:.7},children:"Loading…"}):c.dirs.map(x=>e.jsxs("div",{className:"row",onDoubleClick:()=>m(x.path),style:{padding:"8px 12px",cursor:"pointer"},children:[e.jsx("i",{className:"fa fa-folder",style:{marginRight:8}})," ",x.name]},x.path)),!c.loading&&!c.dirs.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No subfolders"})]})]}),e.jsxs("div",{style:{flex:"1 1 auto",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Files"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[c.files.map(x=>e.jsxs("div",{className:"row",onClick:()=>p(y=>({...y,filename:x.name})),style:{padding:"8px 12px",cursor:"pointer",display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("i",{className:"fa fa-file",style:{marginRight:8}})," ",x.name]}),e.jsx("div",{style:{opacity:.6,fontSize:12},children:x.size})]},x.path)),!c.files.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No files"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"10px 14px",borderTop:"1px solid #2a2a2a"},children:[e.jsx("label",{style:{fontSize:12,opacity:.8},children:"Filename"}),e.jsx("input",{value:c.filename,onChange:x=>p(y=>({...y,filename:x.target.value})),style:{flex:1,background:"#111",border:"1px solid #333",borderRadius:6,color:"#ddd",padding:"8px 10px",fontFamily:"ui-monospace, Menlo, Consolas, monospace"}}),e.jsxs("button",{className:"btn",onClick:()=>{const x=c.filename.endsWith(".json")?c.filename:`${c.filename}.json`;l({dirPath:c.cwd,filename:x})},children:[e.jsx("i",{className:"fa fa-save"})," Save"]})]}),d&&e.jsx("div",{style:{padding:"6px 14px",color:"#f88"},children:String(d)})]})})}function et(){if(document.getElementById("fa-cdn"))return;const a=document.createElement("link");a.id="fa-cdn",a.rel="stylesheet",a.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css",document.head.appendChild(a)}function tt(){const a=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",i=window.wpApiSettings&&window.wpApiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:a.replace(/\/$/,""),nonce:i}}async function nt(){try{const c=await H(()=>import("./chunks/api-DaHWQA7t.js"),[]),p=c.getNodesManifest||c.default&&c.default.getNodesManifest;if(typeof p=="function"){const d=await p();return Array.isArray(d)?d:[]}}catch{}const{root:a,nonce:i}=tt(),l=await fetch(`${a}/yolandi/v1/nodes`,{credentials:"same-origin",headers:i?{"X-WP-Nonce":i}:{}});if(!l.ok)throw new Error(`Nodes fetch failed: ${l.status}`);const f=await l.json();return Array.isArray(f)?f:[]}function Re(){const a=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",i=window.wpApiSettings&&window.wp.apiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:a.replace(/\/$/,""),nonce:i}}function se(){const{root:a}=Re();return`${a}/yolandi/v1`}function pe(){const{nonce:a}=Re();return a?{"Content-Type":"application/json","X-WP-Nonce":a}:{"Content-Type":"application/json"}}async function st(a,{settings:i={},env:l={},scriptSlug:f="workflow",scriptVersion:c="1"}={}){const p=await fetch(`${se()}/jobs/enqueue`,{method:"POST",headers:pe(),credentials:"same-origin",body:JSON.stringify({script_slug:f,script_version:c,payload:{mode:"workflow",workflow:a,settings:i,env:l}})});if(!p.ok)throw new Error(`enqueue ${p.status}`);return p.json()}async function ot(a){const i=await fetch(`${se()}/jobs/${a}`,{headers:pe(),credentials:"same-origin"});if(!i.ok)throw new Error(`get job ${i.status}`);return i.json()}async function Ne(a,i){const l=await fetch(`${se()}/jobs/${a}/control`,{method:"POST",headers:pe(),credentials:"same-origin",body:JSON.stringify({control:i})});if(!l.ok)throw new Error(`control ${l.status}`);return l.json().catch(()=>({}))}async function it(a){const i=await fetch(`${se()}/jobs/${a}/cancel`,{method:"POST",headers:pe(),credentials:"same-origin"});if(!i.ok)throw new Error(`cancel ${i.status}`);return i.json().catch(()=>({}))}function at({runnerId:a,nodesDir:i,runnerPath:l}={}){const f=se(),c=a||`runner-${Math.random().toString(36).slice(2)}`,p=i||"/wp-content/plugins/yolandi/nodes",d=l||"/wp-content/plugins/yolandi/runner/pause-aware-runner.js",g=[`$env:YOLANDI_API="${f}"`,`$env:YOLANDI_NODES_DIR="${p}"`,`$env:YOLANDI_RUNNER_ID="${c}"`,`node "${d}"`].join(" ; "),m=[`YOLANDI_API='${f}'`,`YOLANDI_NODES_DIR='${p}'`,`YOLANDI_RUNNER_ID='${c}'`,`node '${d}'`].join(" ");return{ps:g,sh:m}}function rt(a){return(i,l="DEBUG")=>{const f=document.querySelector(a);if(!f)return;const c=new Date().toLocaleTimeString();f.textContent+=`${f.textContent?`
`:""}[${c}] ${l} — ${i}`,f.parentElement.scrollTop=f.parentElement.scrollHeight}}function lt(a){return i=>{const l=document.querySelector(a);if(!l)return;const f=new Date().toLocaleTimeString();l.textContent+=`${l.textContent?`
`:""}[${f}] ${i}`,l.parentElement.scrollTop=l.parentElement.scrollHeight}}function ct(){const[a,i]=u.useState([]),[l,f]=u.useState(!0),[c,p]=u.useState("puppeteer"),[d,g]=u.useState([{id:"w1",title:"Workflow 1",dirty:!1}]),[m,x]=u.useState("w1"),[y,w]=u.useState({open:!1,json:null}),[j,k]=u.useState(!1),[O,T]=u.useState(()=>{const t=localStorage.getItem("yolandi_token"),n=document.cookie.includes("yolandi_bypass=1");return{token:t,user:null,bypass:n,locked:!t&&!n}}),[E,C]=u.useState(null),[N,L]=u.useState(null),[_,X]=u.useState(""),[V,Z]=u.useState(""),Y=u.useRef(null),I=rt("#ystudio-terminal pre"),D=lt("#ystudio-runner pre"),Q=u.useRef(""),G=u.useRef("w1"),M=u.useRef(Object.create(null));u.useEffect(()=>{et()},[]),u.useEffect(()=>{(async()=>{try{const t=await nt();i(t)}catch(t){I(`Failed to load nodes: ${(t==null?void 0:t.message)||t}`,"ERROR")}})()},[]),u.useEffect(()=>{const{ps:t,sh:n}=at({});X(t),Z(n)},[]),u.useEffect(()=>{if(!E)return;let t=!1;const n=async()=>{try{const o=await ot(E);L(o);const r=(o==null?void 0:o.status)||"queued";r!==Q.current&&(D(`Job #${E} → ${r}`),Q.current=r)}catch(o){D(`Poll error: ${o.message}`)}finally{t||setTimeout(n,2e3)}};return n(),()=>{t=!0}},[E]),u.useEffect(()=>{const t={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)},n=o=>o.map(r=>{try{return typeof r=="string"?r:JSON.stringify(r)}catch{return String(r)}}).join(" ");return console.log=(...o)=>{I(n(o),"INFO"),t.log(...o)},console.warn=(...o)=>{I(n(o),"WARN"),t.warn(...o)},console.error=(...o)=>{I(n(o),"ERROR"),t.error(...o)},()=>{console.log=t.log,console.warn=t.warn,console.error=t.error}},[]),u.useEffect(()=>{window.YOLANDI=window.YOLANDI||{},window.YOLANDI.log=I,window.YOLANDI.runnerLog=D,window.YOLANDI.actions=window.YOLANDI.actions||{},window.YOLANDI.actions.onNodeDrop=(t,n)=>{var o;if(O.locked){k(!0);return}(o=Y.current)==null||o.addNodeByMeta(t,n)},window.YOLANDI.actions.onFileSave=ce,window.YOLANDI.actions.onFileSaveAs=ne,window.YOLANDI.devBypass=()=>{document.cookie="yolandi_bypass=1; max-age=86400; path=/",T(t=>({...t,bypass:!0,locked:!1}))}},[O.locked]),u.useEffect(()=>{const t=n=>{n.ctrlKey&&n.key.toLowerCase()==="s"&&(n.preventDefault(),n.shiftKey?ne():ce())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)});function z(){var t;return((t=Y.current)==null?void 0:t.exportJSON())||{nodes:[],links:[]}}function K(t){var n;(n=Y.current)==null||n.importJSON(t||{nodes:[],links:[]})}u.useEffect(()=>{var n;const t=G.current;if(t&&t!==m){try{const r=z();M.current[t]={...M.current[t]||{},data:r}}catch(r){I(`Save active tab before switch failed: ${r.message}`,"WARN")}const o=((n=M.current[m])==null?void 0:n.data)||{nodes:[],links:[]};K(o)}G.current=m},[m]),u.useEffect(()=>{var r,h;const t=Y.current,n=()=>g(b=>b.map(S=>S.id===m?{...S,dirty:!0}:S));let o=null;return(r=t==null?void 0:t.onDirty)!=null&&r.subscribe?o=t.onDirty.subscribe(n):(h=t==null?void 0:t.onChange)!=null&&h.subscribe?o=t.onChange.subscribe(n):t!=null&&t.on&&(t.on("change",n),o=()=>{var b;return(b=t.off)==null?void 0:b.call(t,"change",n)}),()=>{typeof o=="function"&&o()}},[m]);async function oe(){try{const t=z(),{id:n}=await st(t,{settings:{},env:{}});C(n),D(`Enqueued job #${n}`)}catch(t){D(`Enqueue failed: ${t.message}`),alert(`Enqueue failed: ${t.message}`)}}async function ee(){if(E)try{await Ne(E,"pause"),D(`Pause requested for #${E}`)}catch(t){alert(t.message)}}async function U(){if(E)try{await Ne(E,"resume"),D(`Resume requested for #${E}`)}catch(t){alert(t.message)}}async function ie(){if(E)try{await it(E),D(`Cancel requested for #${E}`)}catch(t){alert(t.message)}}const W=(N==null?void 0:N.status)==="paused",te=["succeeded","failed","canceled"].includes((N==null?void 0:N.status)||""),fe=!!E&&!W&&!te;function ae(t,n){var b;const o=String(t).replace(/^\/+/,"");let r=(((b=window==null?void 0:window.wpApiSettings)==null?void 0:b.root)||"").toString(),h;if(r&&/^https?:\/\//i.test(r)?h=new URL(r.replace(/\/+$/,"/")+o):h=new URL("/wp-json/"+o,window.location.origin),n)for(const[S,v]of Object.entries(n))v!=null&&h.searchParams.set(S,v);return h.toString()}async function re(t=null){const n=ae("yolandi/v1/fs/ls",t?{path:t}:void 0),o=await fetch(n,{credentials:"include"});if(!o.ok)throw o.status===404?new Error("fs/ls 404 (install yolandi/v1/fs/ls route)"):new Error(`fs/ls HTTP ${o.status}`);return o.json()}async function le({path:t,name:n,json:o}){const r=ae("yolandi/v1/fs/save"),h=await fetch(r,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,name:n,json:o})});if(!h.ok)throw h.status===404?new Error("fs/save 404 (install yolandi/v1/fs/save route)"):new Error(`fs/save HTTP ${h.status}`);return h.json()}async function ce(){const t=z(),n=JSON.stringify(t,null,2),o=M.current[m]||{};if(!o.path||!o.name)return ne();try{await le({path:o.path,name:o.name,json:n}),g(r=>r.map(h=>h.id===m?{...h,dirty:!1}:h)),I(`Saved: ${o.path}/${o.name}`,"INFO")}catch(r){I(`Save failed: ${r.message}`,"ERROR"),alert("Save failed: "+r.message)}}function ne(){const t=JSON.stringify(z(),null,2);w({open:!0,json:t})}async function me({dirPath:t,filename:n}){try{await le({path:t,name:n,json:y.json}),M.current[m]={...M.current[m]||{},path:t,name:n},g(o=>o.map(r=>r.id===m?{...r,title:n.replace(/\.json$/i,""),dirty:!1}:r)),w({open:!1,json:null}),I(`Saved: ${t}/${n}`,"INFO")}catch(o){I(`Save As failed: ${o.message}`,"ERROR"),alert("Save As failed: "+o.message)}}function he(){const t=z()||{},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`yolandi-workflow-${Date.now()}.json`,o.click(),URL.revokeObjectURL(o.href)}function J(){document.getElementById("ystudio-import").click()}function s(t){var r;const n=(r=t.target.files)==null?void 0:r[0];if(!n)return;const o=new FileReader;o.onload=()=>{try{const h=JSON.parse(String(o.result));K(h),g(b=>b.map(S=>S.id===m?{...S,dirty:!0}:S)),I("Workflow imported","INFO")}catch(h){I("Import failed: "+((h==null?void 0:h.message)||h),"ERROR")}},o.readAsText(n),t.target.value=""}return e.jsxs("div",{id:"ystudio","data-palette":l?"open":"closed",children:[e.jsx("input",{id:"ystudio-import",type:"file",accept:"application/json",onChange:s,style:{display:"none"}}),e.jsx(Ue,{isRunning:fe,isPaused:W,isTerminal:te,onPlayPause:()=>!E||te?oe():W?U():ee(),onStop:ie,onExport:he,onImport:J,log:I}),e.jsxs("div",{id:"ystudio-main",style:{paddingBottom:28},children:[e.jsx(Ge,{activePanel:c,setActivePanel:p,paletteOpen:l,setPaletteOpen:f,manifest:a,log:I,auth:O}),e.jsxs("div",{id:"ystudio-editor",children:[e.jsxs("div",{className:"tabs",children:[d.map(t=>e.jsxs("div",{className:`tab ${t.id===m?"active":""}`,onClick:()=>x(t.id),children:[e.jsxs("span",{className:"name",children:[t.title,t.dirty?"*":""]}),e.jsx("button",{className:"close",onClick:n=>{if(n.stopPropagation(),t.id===m){const r=z();M.current[t.id]={...M.current[t.id]||{},data:r}}g(r=>r.filter(h=>h.id!==t.id));const o=M.current;o[t.id]&&delete o[t.id],setTimeout(()=>{if(!document.querySelector(".tabs .tab")){const r="w"+Math.random().toString(36).slice(2,7);g([{id:r,title:"Untitled",dirty:!1}]),x(r),M.current[r]={data:{nodes:[],links:[]},path:null,name:null},K({nodes:[],links:[]})}},0)},children:e.jsx("i",{className:"fa fa-xmark"})})]},t.id)),e.jsx("button",{className:"tab add",onClick:()=>{const t="w"+Math.random().toString(36).slice(2,7);g(n=>[...n,{id:t,title:"Untitled",dirty:!0}]),M.current[t]={data:{nodes:[],links:[]},path:null,name:null},x(t)},title:"New Workflow",children:e.jsx("i",{className:"fa fa-plus"})})]}),e.jsxs("div",{id:"ystudio-editor-host",style:{position:"relative",flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[e.jsx("div",{className:"canvas-wrap",style:{position:"relative",flex:"1 1 auto",minHeight:0},children:e.jsx(ze,{registerApi:t=>Y.current=t})}),e.jsx(Ke,{jobId:E,job:N,runnerCmdPS:_,runnerCmdSH:V,onPlay:oe,onPause:ee,onResume:U,onCancel:ie})]})]})]}),j&&e.jsx(Ze,{onClose:()=>k(!1),onLoggedIn:()=>k(!1)}),y.open&&e.jsx(Qe,{initialPath:null,fsLs:re,onClose:()=>w({open:!1,json:null}),onConfirm:me}),e.jsxs("div",{id:"ystudio-statusbar",style:{position:"fixed",left:0,right:0,bottom:0,zIndex:30},children:[e.jsxs("div",{className:"left",children:[e.jsx("i",{className:"fa fa-code-branch"})," main ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-circle"})," Ready"]}),e.jsxs("div",{className:"right",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Job: ",E?(N==null?void 0:N.status)||"queued":"idle"," ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-rotate"})," Auto-save"]})]})]})}const dt=[{key:"scripts",label:"Scripts",Component:Be},{key:"jobs",label:"Jobs",Component:qe},{key:"nodes",label:"Nodes",Component:He},{key:"graph",label:"Graph",Component:ct}];self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(a,i){switch(i){case"json":return new Ce;case"css":return new Oe;case"html":return new Ee;case"typescript":case"javascript":return new ke;default:return new Se}}});function ut(){const{active:a}=Pe(dt,"scripts"),i=(a==null?void 0:a.Component)||(()=>e.jsx("div",{}));return e.jsxs("div",{style:{padding:12},children:[e.jsx("h1",{children:"YOLANDI Admin"}),e.jsx(i,{})]})}(function(){const i=document.getElementById("yolandi-root");if(!i)return;Me.createRoot(i).render(e.jsx(ut,{}))})();
