const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/vendor-Cu9HgnO8.js","chunks/vendor-react-Bifdz3QC.js","chunks/index-COnHatJ4.js","chunks/NodeTree-CX6rf2z9.js","chunks/index-BIJwCuMh.js","chunks/index-FIUVNo2M.js","chunks/index-DvgFIqc0.js"])))=>i.map(i=>d[i]);
import{a as d,j as e}from"./chunks/vendor-react-Bifdz3QC.js";import{W as ve,a as be,b as Ne,c as Se,d as ke,_ as G,e as $e}from"./chunks/vendor-Cu9HgnO8.js";function pe(){const r=(window.location.hash||"").replace(/^#\/?/,""),[s,...a]=r.split("/");return{key:s||"",rest:a.join("/")}}function Ce(r,s=""){const a=d.useMemo(()=>r.reduce((c,y)=>(c[y.key]=y,c),{}),[r]),[m,l]=d.useState(()=>{const{key:c}=pe();return a[c]?c:s});d.useEffect(()=>{const c=()=>{const{key:y}=pe();l(a[y]?y:s)};return window.addEventListener("hashchange",c),()=>window.removeEventListener("hashchange",c)},[a,s]);const u=c=>{a[c]&&pe().key!==c&&(window.location.hash=`#/${c}`)};return{routeKey:m,active:a[m],navigate:u}}const xe=window.YOLANDI_CONFIG||{},ye=window.location.origin.replace(/\/$/,""),Re=[(xe.restRoot||"").replace(/\/$/,""),(xe.restRootQuery||"").replace(/\/$/,""),`${ye}/index.php?rest_route=/yolandi/v1`,`${ye}/wp-json/yolandi/v1`].filter(Boolean);Re[0];function Ae(){let r=window.YOLANDI_BOOT&&window.YOLANDI_BOOT.restBase||"";if(!r){const s=document.querySelector('link[rel="https://api.w.org"]');s!=null&&s.href&&(r=s.href.replace(/\/$/,"")+"/yolandi/v1")}return r||(r="/wp-json/yolandi/v1"),r.replace(/\/$/,"")}async function ge(r,s={}){var x,h;const a={"Content-Type":"application/json","X-WP-Nonce":((x=window==null?void 0:window.YOLANDI_BOOT)==null?void 0:x.nonce)||((h=window==null?void 0:window.wpApiSettings)==null?void 0:h.nonce)||"",...s.headers||{}},m={credentials:"same-origin",...s,headers:a};m.body&&typeof m.body!="string"&&!(m.body instanceof FormData)&&(m.body=JSON.stringify(m.body));const l=await fetch(r,m),u=await l.text(),c=(l.headers.get("content-type")||"").includes("application/json"),y=c?u?JSON.parse(u):null:u;return{resp:l,isJson:c,body:y,text:u}}async function me(r,s={}){const a=Ae(),m=r.startsWith("/")?r:`/${r}`,l=`${a}${m}`,u={...s};u.body!=null&&typeof u.body!="string"&&!(u.body instanceof FormData)&&(u.body=JSON.stringify(u.body));let{resp:c,isJson:y,body:x}=await ge(l,u);const h=typeof x=="string"&&x.trim().startsWith("<!DOCTYPE");if((!c.ok||h)&&!u.__fallbackTried){const g=`${l.replace(a,"")}`.replace(/^\//,""),w=`${window.location.origin}/index.php?rest_route=/yolandi/v1/${g}`,N=await ge(w,{...u,__fallbackTried:!0});c=N.resp,y=N.isJson,x=N.body}if(!c.ok){const g=new Error(`API ${c.status} ${c.statusText}`);throw g.status=c.status,g.url=c.url,g.body=x,g}if(!y||x==null){const g=new Error("API returned non-JSON response");throw g.url=c.url,g.body=x,g}return x}self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(r,s){switch(s){case"json":return new ke;case"css":return new Se;case"html":return new Ne;case"typescript":case"javascript":return new be;default:return new ve}}});async function Le(){const r=await G(()=>import("./chunks/vendor-Cu9HgnO8.js").then(s=>s.m),__vite__mapDeps([0,1]));return await Promise.all([G(()=>import("./chunks/vendor-Cu9HgnO8.js").then(s=>s.f),__vite__mapDeps([0,1])),G(()=>import("./chunks/vendor-Cu9HgnO8.js").then(s=>s.g),__vite__mapDeps([0,1])),G(()=>import("./chunks/vendor-Cu9HgnO8.js").then(s=>s.h),__vite__mapDeps([0,1])),G(()=>import("./chunks/vendor-Cu9HgnO8.js").then(s=>s.i),__vite__mapDeps([0,1]))]),r}function Ie(r="{}"){const s=d.useRef(null),[a,m]=d.useState(r);return d.useEffect(()=>{let l;return(async()=>{try{l=(await Le()).editor.create(s.current,{value:r,language:"json",automaticLayout:!0,minimap:{enabled:!1}}),l.onDidChangeModelContent(()=>m(l.getValue()))}catch{if(s.current){const u=document.createElement("textarea");u.value=r,u.style.width="100%",u.style.height="260px",u.addEventListener("input",()=>m(u.value)),s.current.appendChild(u)}}})(),()=>{var u;return(u=l==null?void 0:l.dispose)==null?void 0:u.call(l)}},[]),[s,a,m]}function De(){const[r,s]=d.useState("example-search"),[a,m]=d.useState(1),[l,u]=d.useState('{ "q": "hello" }'),[c,y]=Ie(`{
  "nodes": [
    { "id": "n1", "type": "SetDevice", "props": { "profile": "Pixel7" } },
    { "id": "n2", "type": "ProxyDirector", "props": { "director": "webshare-main", "sessionSeed": "\${jobId}" } },
    { "id": "n3", "type": "Navigate", "props": { "url": "https://example.com" } },
    { "id": "n4", "type": "Screenshot", "props": { "path": "\${artifacts}/shot.png", "fullPage": true } }
  ],
  "edges": [ { "from": "n1", "to": "n2" }, { "from": "n2", "to": "n3" }, { "from": "n3", "to": "n4" } ],
  "meta": { "slug": "example-search", "version": 1 }
}`);async function x(){let h;try{h=JSON.parse(y)}catch{alert("Invalid JSON graph");return}const g={script_slug:r,script_version:Number(a),params:JSON.parse(l||"{}"),priority:5},w=await me("/jobs/enqueue",{method:"POST",body:g});w!=null&&w.id?alert(`Enqueued Job #${w.id}`):alert("Failed to enqueue")}return e.jsxs("div",{children:[e.jsx("h2",{children:"Script JSON"}),e.jsx("div",{ref:c,style:{border:"1px solid #ccd0d4",height:280}}),e.jsx("h3",{style:{marginTop:16},children:"Run Parameters"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Slug: ",e.jsx("input",{value:r,onChange:h=>s(h.target.value)})]}),e.jsxs("label",{children:["Version: ",e.jsx("input",{type:"number",min:1,value:a,onChange:h=>m(h.target.value),style:{width:80}})]})]}),e.jsx("textarea",{value:l,onChange:h=>u(h.target.value),style:{width:"100%",height:120,marginTop:8}}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("button",{className:"button button-primary",onClick:x,children:"Enqueue Test Run"}),e.jsxs("span",{style:{marginLeft:8,color:"#555"},children:["Posts to ",e.jsx("code",{children:"/jobs/enqueue"}),". Save graphs under ",e.jsx("code",{children:"scripts/<slug>/vNNN.json"}),"."]})]})]})}function _e(){const[r,s]=d.useState(0),[a,m]=d.useState(null),[l,u]=d.useState(!1);async function c(){if(!r)return;u(!0);const y=await me(`/jobs/${r}`);m(y||null),u(!1)}return e.jsxs("div",{children:[e.jsx("h2",{children:"Jobs"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Job ID: ",e.jsx("input",{type:"number",value:r,onChange:y=>s(Number(y.target.value))})]}),e.jsx("button",{className:"button",onClick:c,children:"Load"})]}),l?e.jsx("p",{children:"Loading…"}):null,a?e.jsxs("div",{style:{marginTop:12},children:[e.jsx("table",{className:"widefat fixed striped",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("td",{children:a.id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("td",{children:a.status})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Script"}),e.jsxs("td",{children:[a.script_slug," v",a.script_version]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Attempts"}),e.jsxs("td",{children:[a.attempts," / ",a.max_attempts]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Runner"}),e.jsx("td",{children:a.runner_id||""})]})]})}),a.artifacts?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Artifacts"}),e.jsx("pre",{style:{background:"#f6f7f7",padding:8,whiteSpace:"pre-wrap"},children:JSON.stringify(a.artifacts,null,2)})]}):null,a.error?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Error"}),e.jsx("pre",{style:{background:"#fff4f4",padding:8,color:"#a00"},children:JSON.stringify(a.error,null,2)})]}):null]}):null]})}function Te(){const[r,s]=d.useState([]),[a,m]=d.useState(!1),[l,u]=d.useState("");return d.useEffect(()=>{let c=!0;return m(!0),me("/nodes").then(y=>{c&&(Array.isArray(y)?s(y):u(String(y||"")))}).finally(()=>c&&m(!1)),()=>c=!1},[]),e.jsxs("div",{children:[e.jsx("h2",{children:"Nodes"}),a?e.jsx("p",{children:"Loading…"}):null,l&&e.jsx("p",{style:{color:"#a00"},children:l}),e.jsxs("table",{className:"widefat fixed striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Version"})]})}),e.jsx("tbody",{children:r.map(c=>{var y,x,h,g;return e.jsxs("tr",{children:[e.jsx("td",{children:c.path}),e.jsx("td",{children:((y=c.meta)==null?void 0:y.type)||"?"}),e.jsx("td",{children:((x=c.meta)==null?void 0:x.title)||""}),e.jsx("td",{children:((h=c.meta)==null?void 0:h.category)||""}),e.jsx("td",{children:((g=c.meta)==null?void 0:g.version)||""})]},c.path)})})]}),e.jsxs("p",{style:{marginTop:8},children:["Add custom nodes by dropping ",e.jsx("code",{children:".mjs"})," files into"," ",e.jsx("code",{children:"wp-content/plugins/yolandi/nodes/"}),", then reload this page."]})]})}const we=()=>Math.random().toString(36).slice(2,9);function Me({registerApi:r}){function s(i,t,o){return`${i}:${t}:${o}`}function a(i,t,o){const v=document.querySelector(`[data-port-key="${s(i,t,o)}"] .dot`)||document.querySelector(`[data-port-key="${s(i,t,o)}"]`);if(!v)return null;const b=v.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top+b.height/2}}const m=280,l=28,u=22,c=d.useRef(null),y=d.useRef(null),[x,h]=d.useState([]),[g,w]=d.useState([]),[N,C]=d.useState({x:0,y:0,k:1}),[I,Y]=d.useState("select"),[R,D]=d.useState(null),[S,T]=d.useState(null),[P,Q]=d.useState(null),B=(i,t)=>{const o=c.current.getBoundingClientRect();return{x:(i-o.left-N.x)/N.k,y:(t-o.top-N.y)/N.k}},ie=i=>x.find(t=>t.id===i);d.useEffect(()=>{const i={addNodeByMeta(t,o){var J,F,te;const{x:v,y:b}=B(o.x,o.y),k="n"+we(),$=(t==null?void 0:t.title)||(t==null?void 0:t.type)||"Node",A=(t==null?void 0:t.props)||{},E={};for(const[H,U]of Object.entries(A))E[H]=(J=U==null?void 0:U.default)!=null?J:"";const L=(((F=t==null?void 0:t.io)==null?void 0:F.inputs)||["in"]).map((H,U)=>({id:"i"+U,name:H})),_=(((te=t==null?void 0:t.io)==null?void 0:te.outputs)||["out"]).map((H,U)=>({id:"o"+U,name:H}));h(H=>[...H,{id:k,x:Math.round(v-m/2),y:Math.round(b-16),w:m,title:$,meta:t,fields:E,inputs:L,outputs:_,selected:!1}])},exportJSON(){return{version:1,view:N,nodes:x.map(t=>{var o;return{id:t.id,title:t.title,type:((o=t.meta)==null?void 0:o.type)||null,x:t.x,y:t.y,w:t.w,fields:t.fields,inputs:t.inputs,outputs:t.outputs}}),links:g}},importJSON(t){!t||!Array.isArray(t.nodes)||(C(t.view||{x:0,y:0,k:1}),h(t.nodes.map(o=>({id:o.id,title:o.title||"Node",meta:{type:o.type||"Imported"},x:o.x,y:o.y,w:o.w||m,fields:o.fields||{},inputs:o.inputs||[{id:"i0",name:"in"}],outputs:o.outputs||[{id:"o0",name:"out"}],selected:!1}))),w(Array.isArray(t.links)?t.links:[]))},setMode:Y};r==null||r(i),window.YOLANDI=window.YOLANDI||{},window.YOLANDI.exportWorkflow=()=>i.exportJSON(),window.YOLANDI.importWorkflow=t=>i.importJSON(t)},[x,g,N,r]);const ee=(i,t,o)=>{const v=a(i,t,o);if(!v)return null;const b=c.current.getBoundingClientRect();return{x:(v.x-b.left-N.x)/N.k,y:(v.y-b.top-N.y)/N.k}},ue=d.useMemo(()=>{const i=[];for(const t of g){const o=ee("out",t.from.nid,t.from.pid),v=ee("in",t.to.nid,t.to.pid);if(!o||!v)continue;const b=Math.max(40,Math.abs(v.x-o.x)*.6);i.push({id:t.id,d:`M ${o.x},${o.y} C ${o.x+b},${o.y} ${v.x-b},${v.y} ${v.x},${v.y}`})}if(S){const t=ee("out",S.from.nid,S.from.pid),o=B(S.x,S.y);if(t&&o){const v=Math.max(40,Math.abs(o.x-t.x)*.6);i.push({id:"_wip",d:`M ${t.x},${t.y} C ${t.x+v},${t.y} ${o.x-v},${o.y} ${o.x},${o.y}`})}}return i},[g,S,x,N]);function q(i,t){C(o=>{const k=Math.min(2,Math.max(.3,o.k*i));if(!t)return{...o,k};const $=c.current.getBoundingClientRect(),A=(t.x-$.left-o.x)/o.k,E=(t.y-$.top-o.y)/o.k,L=t.x-$.left-A*k,_=t.y-$.top-E*k;return{x:L,y:_,k}})}d.useEffect(()=>{const i=c.current;if(!i)return;const t=o=>{o.ctrlKey?(o.preventDefault(),q(o.deltaY<0?1.1:1/1.1,{x:o.clientX,y:o.clientY})):I==="pan"&&(o.preventDefault(),C(v=>({...v,x:v.x-o.deltaX,y:v.y-o.deltaY})))};return i.addEventListener("wheel",t,{passive:!1}),()=>i.removeEventListener("wheel",t)},[I]);function M(i){var k,$,A,E;if(($=(k=i.target).closest)!=null&&$.call(k,".yc-node")||(E=(A=i.target).closest)!=null&&E.call(A,".yc-port"))return;if(I==="pan"||i.button===1){const L={sx:i.clientX,sy:i.clientY,vx:N.x,vy:N.y},_=F=>C({x:L.vx+(F.clientX-L.sx),y:L.vy+(F.clientY-L.sy),k:N.k}),J=()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",J)};window.addEventListener("mousemove",_),window.addEventListener("mouseup",J);return}const t=B(i.clientX,i.clientY);let o={sx:t.x,sy:t.y,ex:t.x,ey:t.y,sxScr:i.clientX,syScr:i.clientY,exScr:i.clientX,eyScr:i.clientY};Q(o);const v=L=>{const _=B(L.clientX,L.clientY);o={...o,ex:_.x,ey:_.y,exScr:L.clientX,eyScr:L.clientY},Q(o);const J=Math.min(o.sx,o.ex),F=Math.min(o.sy,o.ey),te=Math.max(o.sx,o.ex),H=Math.max(o.sy,o.ey);h(U=>U.map(z=>{const n=l+8+Math.max(z.inputs.length,z.outputs.length)*u+12+Object.keys(z.fields).length*(u+4),p=z.x,f=z.y,j=z.x+z.w,O=z.y+n,X=!(j<J||p>te||O<F||f>H);return{...z,selected:X}}))},b=()=>{Q(null),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b)};window.addEventListener("mousemove",v),window.addEventListener("mouseup",b)}function V(i,t){i.button===0&&ne(i,t)}function re(i,t){if(i.button!==0)return;const o=i.target.tagName;["INPUT","SELECT","TEXTAREA","BUTTON"].includes(o)||i.target.closest(".yc-port")||ne(i,t)}function ne(i,t){if(!ie(t))return;const v=x.filter(A=>A.selected).map(A=>A.id),b=v.length?v:[t],k=B(i.clientX,i.clientY),$=b.map(A=>{const E=ie(A);return{id:A,dx:k.x-E.x,dy:k.y-E.y}});D({ids:b,offsets:$}),i.stopPropagation()}d.useEffect(()=>{const i=o=>{if(!R)return;const v=B(o.clientX,o.clientY);h(b=>b.map(k=>{const $=R.offsets.find(A=>A.id===k.id);return $?{...k,x:Math.round(v.x-$.dx),y:Math.round(v.y-$.dy)}:k}))},t=()=>D(null);return window.addEventListener("mousemove",i),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",t)}},[R]);function W(i,t,o){const v=document.querySelector(`[data-port-key="out:${i}:${t}"] .dot`);if(!v)return;const b=v.getBoundingClientRect();T({from:{nid:i,pid:t},x:b.left+b.width/2,y:b.top+b.height/2}),o.stopPropagation()}function Z(i){S&&T(t=>({...t,x:i.clientX,y:i.clientY}))}function se(i,t){const o=Array.from(document.querySelectorAll(".yc-port.in"));let v=null,b=256;for(const k of o){const $=k.getAttribute("data-port-key"),[,A,E]=$.split(":"),L=ee("in",A,E);if(!L)continue;const _=L.x-i,J=L.y-t,F=_*_+J*J;F<b&&(b=F,v={nid:A,pid:E})}return v}function ae(i,t,o){if(!S)return;if(!i||!t){const k=B(o.clientX,o.clientY),$=se(k.x,k.y);$&&(i=$.nid,t=$.pid)}if(!i||!t){T(null);return}const b={id:"l"+we(),from:S.from,to:{nid:i,pid:t}};w(k=>[...k.filter($=>!($.to.nid===i&&$.to.pid===t)),b]),T(null),o.stopPropagation()}function le(){S&&T(null)}return e.jsxs("div",{id:"yc-canvas",ref:c,style:{position:"absolute",inset:0},onMouseMove:Z,onMouseUp:le,onMouseDown:M,onDragOver:i=>{var t,o;(o=(t=i.dataTransfer)==null?void 0:t.types)!=null&&o.includes("application/x-yolandi-node")&&(i.preventDefault(),i.dataTransfer.dropEffect="copy")},onDrop:i=>{var v,b,k;const t=(v=i.dataTransfer)==null?void 0:v.getData("application/x-yolandi-node");if(!t)return;i.preventDefault(),i.stopPropagation();const o=JSON.parse(t);(k=(b=window.YOLANDI.actions).onNodeDrop)==null||k.call(b,o,{x:i.clientX,y:i.clientY})},children:[e.jsxs("div",{ref:y,className:"yc-content",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",transformOrigin:"0 0",transform:`translate(${N.x}px, ${N.y}px) scale(${N.k})`},children:[e.jsx("svg",{className:"yc-wires",width:"20000",height:"12000",style:{position:"absolute",left:0,top:0,overflow:"visible",pointerEvents:"none",zIndex:0},children:ue.map(i=>e.jsx("path",{d:i.d,className:i.id==="_wip"?"yc-wire wip":"yc-wire",stroke:i.id==="_wip"?"rgba(96,165,250,.7)":"rgba(96,165,250,.95)",strokeWidth:2,fill:"none",style:{vectorEffect:"non-scaling-stroke"}},i.id))}),x.map(i=>e.jsxs("div",{className:`yc-node ${i.selected?"selected":""}`,style:{left:i.x,top:i.y,width:i.w,position:"absolute",zIndex:1},onMouseDown:t=>re(t,i.id),children:[e.jsxs("div",{className:"yc-head",onMouseDown:t=>V(t,i.id),title:i.title,children:[e.jsx("i",{className:"fa fa-grip-lines"}),e.jsx("span",{children:i.title})]}),e.jsxs("div",{className:"yc-ports",children:[e.jsx("div",{className:"col in",children:i.inputs.map(t=>e.jsxs("div",{className:"yc-port in","data-port-key":`in:${i.id}:${t.id}`,onMouseUp:o=>ae(i.id,t.id,o),children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"name",children:t.name})]},t.id))}),e.jsx("div",{className:"col out",children:i.outputs.map(t=>e.jsxs("div",{className:"yc-port out","data-port-key":`out:${i.id}:${t.id}`,onMouseDown:o=>W(i.id,t.id,o),children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"dot"})]},t.id))})]}),e.jsx("div",{className:"yc-body",children:Object.entries(i.fields).map(([t,o])=>{var $,A;const v=((A=($=i.meta)==null?void 0:$.props)==null?void 0:A[t])||{type:"string"},b=(v.type||"string").toLowerCase(),k=E=>h(L=>L.map(_=>_.id===i.id?{..._,fields:{..._.fields,[t]:E}}:_));return["bool","boolean","checkbox"].includes(b)?e.jsxs("label",{className:"row check",children:[e.jsx("input",{type:"checkbox",checked:!!o,onChange:E=>k(E.target.checked)}),e.jsx("span",{className:"lab",children:t})]},t):b==="number"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"number",value:o!=null?o:"",onChange:E=>k(E.target.value===""?"":Number(E.target.value))})]},t):b==="select"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("select",{value:o!=null?o:"",onChange:E=>k(E.target.value),children:(v.options||[]).map(E=>e.jsx("option",{value:E,children:String(E)},String(E)))})]},t):e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"text",value:o!=null?o:"",onChange:E=>k(E.target.value)})]},t)})})]},i.id))]}),P&&e.jsx("div",{className:"yc-marquee",style:{position:"fixed",border:"1px dashed rgba(96,165,250,.9)",background:"rgba(96,165,250,.12)",pointerEvents:"none",zIndex:10,left:Math.min(P.sxScr,P.exScr),top:Math.min(P.syScr,P.eyScr),width:Math.abs(P.exScr-P.sxScr),height:Math.abs(P.eyScr-P.syScr)}})]})}function Pe({isRunning:r,isPaused:s,isTerminal:a,onPlayPause:m,onStop:l,onExport:u,onImport:c,log:y}){const[x,h]=d.useState(null),g=d.useRef(null),w=d.useRef(null);d.useEffect(()=>{const D=T=>{g.current&&(g.current.contains(T.target)||h(null))},S=T=>{T.key==="Escape"&&h(null)};return document.addEventListener("mousedown",D),window.addEventListener("keydown",S),()=>{document.removeEventListener("mousedown",D),window.removeEventListener("keydown",S)}},[]);const N=D=>()=>{clearTimeout(w.current),w.current=setTimeout(()=>h(D),80)},C=()=>{clearTimeout(w.current),w.current=setTimeout(()=>h(null),150)},I=D=>S=>{S.preventDefault(),S.stopPropagation(),h(T=>T===D?null:D)},Y=()=>{var D,S;(S=(D=window==null?void 0:window.YOLANDI)==null?void 0:D.actions)!=null&&S.onFileSave?(window.YOLANDI.actions.onFileSave(),h(null)):y==null||y("Save not available (GraphApp actions missing)","WARN")},R=()=>{var D,S;(S=(D=window==null?void 0:window.YOLANDI)==null?void 0:D.actions)!=null&&S.onFileSaveAs?(window.YOLANDI.actions.onFileSaveAs(),h(null)):y==null||y("Save As not available (GraphApp actions missing)","WARN")};return e.jsxs("div",{ref:g,className:"ystudio-menubar",style:{position:"relative",zIndex:50,display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderBottom:"1px solid #222",background:"#121212"},children:[e.jsxs(fe,{id:"file",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-file"})," File"]}),open:x==="file",onHoverOpen:N("file"),onHoverClose:C,onClickToggle:I("file"),children:[e.jsx(ce,{icon:"fa-save",label:"Save",onClick:Y}),e.jsx(ce,{icon:"fa-file-export",label:"Save as…",onClick:R}),e.jsx(Ye,{}),e.jsx(ce,{icon:"fa-download",label:"Export (.json)",onClick:()=>{h(null),u==null||u()}}),e.jsx(ce,{icon:"fa-upload",label:"Import (.json)",onClick:()=>{h(null),c==null||c()}})]}),e.jsx(fe,{id:"nodes",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-diagram-project"})," Nodes"]}),open:x==="nodes",onHoverOpen:N("nodes"),onHoverClose:C,onClickToggle:I("nodes"),children:e.jsx("div",{className:"menu-note",children:"Drop nodes from the sidebar palette."})}),e.jsx(fe,{id:"help",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-circle-question"})," Help"]}),open:x==="help",onHoverOpen:N("help"),onHoverClose:C,onClickToggle:I("help"),children:e.jsx("div",{className:"menu-note",children:"Ctrl+S: Save  •  Ctrl+Shift+S: Save as…"})}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",title:s?"Resume":r?"Pause":"Run",onClick:m,children:s?e.jsx("i",{className:"fa fa-play"}):r?e.jsx("i",{className:"fa fa-pause"}):e.jsx("i",{className:"fa fa-play"})}),e.jsx("button",{className:"btn",title:"Stop",onClick:l,children:e.jsx("i",{className:"fa fa-stop"})})]}),e.jsx("style",{children:`
        .btn {
          background:#2b2b2b;border:1px solid #3a3a3a;border-radius:6px;
          padding:6px 10px;color:#ddd;cursor:pointer;line-height:1;
        }
        .btn:hover { background:#333; }
        .menu-root {
          position: relative;
        }
        .menu-button {
          border: none; background: transparent; color:#ddd; cursor: pointer;
          border-radius: 6px; padding:6px 10px; display:flex; align-items:center; gap:6px;
        }
        .menu-button:hover, .menu-root[aria-expanded="true"] .menu-button {
          background:#1e1e1e;
        }
        .menu-popover {
          position: absolute; top: calc(100% + 4px); left: 0;
          background:#1b1b1b; border:1px solid #333; border-radius:8px;
          min-width: 220px; padding: 6px; z-index: 200;
          box-shadow: 0 6px 24px rgba(0,0,0,0.35);
        }
        .menu-item {
          display:flex; align-items:center; gap:8px;
          width:100%; border:none; background:transparent; color:#ddd;
          padding:8px 10px; border-radius:6px; cursor:pointer; text-align:left;
        }
        .menu-item:hover { background:#2b2b2b; }
        .menu-sep { height:1px; background:#2a2a2a; margin:6px 4px; }
        .menu-note { padding:8px 10px; font-size:12px; opacity:0.8; }
      `})]})}function fe({id:r,label:s,open:a,onHoverOpen:m,onHoverClose:l,onClickToggle:u,children:c}){return e.jsxs("div",{className:"menu-root","aria-expanded":a?"true":"false",onMouseEnter:m,onMouseLeave:l,children:[e.jsxs("button",{type:"button",className:"menu-button",onClick:u,children:[s," ",e.jsx("i",{className:"fa fa-caret-down"})]}),a&&e.jsx("div",{className:"menu-popover",role:"menu","aria-labelledby":r,children:c})]})}function ce({icon:r,label:s,onClick:a}){return e.jsxs("button",{type:"button",className:"menu-item",onClick:a,children:[r?e.jsx("i",{className:`fa ${r}`}):null,e.jsx("span",{children:s})]})}function Ye(){return e.jsx("div",{className:"menu-sep","aria-hidden":"true"})}const Ee=Object.assign({"../activity/loop/index.jsx":()=>G(()=>import("./chunks/index-COnHatJ4.js"),__vite__mapDeps([2,1,3])),"../activity/puppeteer/index.jsx":()=>G(()=>import("./chunks/index-BIJwCuMh.js"),__vite__mapDeps([4,1,3])),"../activity/shop/index.jsx":()=>G(()=>import("./chunks/index-FIUVNo2M.js"),__vite__mapDeps([5,1])),"../activity/workflows/index.jsx":()=>G(()=>import("./chunks/index-DvgFIqc0.js"),__vite__mapDeps([6,1]))});console.log(Ee);function We({manifest:r,log:s,auth:a}){const[m,l]=d.useState([]);d.useEffect(()=>{let c=!1;return(async()=>{const y=[];for(const[x,h]of Object.entries(Ee))try{const g=await h(),w=g.meta||{},C=(g.create||(()=>({id:"x",title:"Unknown",icon:"fa-cube",render:()=>null})))({manifest:r,log:s,auth:a});y.push({id:w.id||C.id,title:w.title||C.title,icon:w.icon||C.icon,render:C.render})}catch(g){console.warn("Activity load failed",x,g)}c||l(y)})(),()=>{c=!0}},[r,s,a]);const u=d.useMemo(()=>m.length?[]:[{id:"puppeteer",title:"Puppeteer",icon:"fa-angle",render:()=>e.jsxs("div",{style:{padding:8,color:"#bbb",fontSize:12},children:["No activity plugins found. Add files under ",e.jsx("code",{children:"admin/activity/*/index.jsx"}),"."]})}],[m]);return m.length?m:u}function Je({activePanel:r,setActivePanel:s,paletteOpen:a,setPaletteOpen:m,manifest:l,log:u,auth:c}){var h,g;const y=We({manifest:l,log:u,auth:c}),x=()=>m(!a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"ystudio-activity",children:y.map(w=>e.jsx("button",{className:`activity-btn ${r===w.id?"active":""}`,title:w.title,onClick:()=>{r===w.id?x():(a||x(),s(w.id))},children:e.jsx("i",{className:`fa ${w.icon}`})},w.id))}),e.jsxs("div",{id:"ystudio-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("span",{className:"label",children:((h=y.find(w=>w.id===r))==null?void 0:h.title)||"Panel"}),e.jsx("button",{className:"icon-btn",onClick:x,title:"Toggle Sidebar",children:e.jsx("i",{className:"fa fa-spider"})})]}),e.jsx("div",{className:"palette-scroll",children:(g=y.find(w=>w.id===r))==null?void 0:g.render()})]})]})}function Fe({jobId:r,job:s,runnerCmdPS:a,runnerCmdSH:m,onPlay:l,onPause:u,onResume:c,onCancel:y}){var N;const x=d.useRef(null),h=d.useRef(null);d.useEffect(()=>{const C=h.current,I=x.current;if(!C||!I)return;let Y=0,R=0;const D=P=>{Y=P.clientY,R=I.getBoundingClientRect().height,document.addEventListener("mousemove",S),document.addEventListener("mouseup",T)},S=P=>{const Q=Y-P.clientY,B=Math.max(120,R+Q);I.style.setProperty("--panel-height",`${B}px`)},T=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",T)};return C.addEventListener("mousedown",D),()=>C.removeEventListener("mousedown",D)},[]);const g=(s==null?void 0:s.status)==="paused",w=["succeeded","failed","canceled"].includes((s==null?void 0:s.status)||"");return e.jsxs("div",{id:"ystudio-panel",ref:x,style:{"--panel-height":"220px",height:"var(--panel-height)",minHeight:120,overflow:"hidden",flex:"0 0 auto"},children:[e.jsxs("div",{id:"ystudio-panel-tabs",children:[e.jsxs("div",{className:"tab active",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Runner"]}),e.jsx("div",{className:"spacer"}),e.jsx("div",{className:"controls"})]}),e.jsx("div",{id:"ystudio-panel-body",style:{height:"calc(var(--panel-height) - 32px)",overflow:"auto"},children:e.jsxs("div",{id:"ystudio-runner",children:[e.jsxs("div",{className:"runner-help",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Windows PowerShell)"}),e.jsx("textarea",{readOnly:!0,value:a,onFocus:C=>C.target.select(),rows:3,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Linux/macOS)"}),e.jsx("textarea",{readOnly:!0,value:m,onFocus:C=>C.target.select(),rows:3,style:{width:"100%"}})]})]}),e.jsxs("div",{className:"runner-status",style:{display:"flex",gap:16,alignItems:"center",margin:"4px 0 8px"},children:[e.jsxs("span",{children:[e.jsx("b",{children:"Job:"})," ",r?`#${r}`:"—"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Status:"})," ",(s==null?void 0:s.status)||(r?"queued":"—")]}),e.jsxs("span",{children:[e.jsx("b",{children:"Runner:"})," ",(s==null?void 0:s.runner_id)||"—"]}),((N=s==null?void 0:s.error)==null?void 0:N.message)&&e.jsxs("span",{style:{color:"crimson"},children:[e.jsx("b",{children:"Error:"})," ",s.error.message]}),e.jsx("span",{className:"spacer",style:{flex:1}}),e.jsxs("button",{className:"btn",onClick:l,title:"Enqueue Workflow",children:[e.jsx("i",{className:"fa fa-play"})," Run"]}),e.jsxs("button",{className:"btn",onClick:g?c:u,disabled:!r||w,title:g?"Resume":"Pause",children:[e.jsx("i",{className:`fa fa-${g?"play":"pause"}`})," ",g?"Resume":"Pause"]}),e.jsxs("button",{className:"btn",onClick:y,disabled:!r||w,title:"Cancel",children:[e.jsx("i",{className:"fa fa-stop"})," Stop"]})]}),e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"}})]})}),e.jsx("div",{id:"ystudio-panel-drag",ref:h,title:"Resize panel"})]})}function Be({onClose:r,onLoggedIn:s}){const[a,m]=d.useState("login"),[l,u]=d.useState({username:"",email:"",password:""}),[c,y]=d.useState("");async function x({username:w,password:N}){try{const I=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:w,password:N})})).json();if(I!=null&&I.token)return localStorage.setItem("yolandi_token",I.token),s(),!0}catch{}return!1}async function h({email:w,username:N,password:C}){try{const Y=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w,username:N,password:C})})).json();if(Y!=null&&Y.token)return localStorage.setItem("yolandi_token",Y.token),s(),!0}catch{}return!1}async function g(){(a==="login"?await x({username:l.username,password:l.password}):await h({email:l.email,username:l.username,password:l.password}))||y("Authentication failed")}return e.jsx("div",{className:"auth-mask",children:e.jsxs("div",{className:"auth-modal",children:[e.jsxs("div",{className:"head",children:[e.jsx("b",{children:"Sign in to YOLANDI.org"}),e.jsx("button",{onClick:r,children:e.jsx("i",{className:"fa fa-xmark"})})]}),e.jsxs("div",{className:"body",children:[a==="register"&&e.jsxs("label",{children:["Email ",e.jsx("input",{type:"email",value:l.email,onChange:w=>u({...l,email:w.target.value})})]}),e.jsxs("label",{children:["Username ",e.jsx("input",{value:l.username,onChange:w=>u({...l,username:w.target.value})})]}),e.jsxs("label",{children:["Password ",e.jsx("input",{type:"password",value:l.password,onChange:w=>u({...l,password:w.target.value})})]}),c&&e.jsx("div",{className:"err",children:c})]}),e.jsxs("div",{className:"foot",children:[e.jsx("button",{onClick:g,className:"primary",children:a==="login"?"Login":"Create Account"}),e.jsx("button",{onClick:()=>m(a==="login"?"register":"login"),className:"ghost",children:a==="login"?"Create an account":"Back to login"}),e.jsx("div",{className:"grow"}),e.jsx("button",{onClick:()=>{var w,N;(N=(w=window.YOLANDI)==null?void 0:w.devBypass)==null||N.call(w),s()},className:"ghost",title:"Developer bypass",children:"Bypass"})]})]})})}function qe({initialPath:r=null,fsLs:s,onConfirm:a,onClose:m}){const[l,u]=d.useState({loading:!0,cwd:"",dirs:[],files:[],filename:"workflow.json",canUp:!1}),[c,y]=d.useState(""),x=async(h=null)=>{y(""),u(g=>({...g,loading:!0}));try{const g=await s(h||r||null);u({loading:!1,cwd:g.cwd,dirs:g.dirs||[],files:g.files||[],filename:"workflow.json",canUp:!!g.canUp})}catch(g){y(g.message||String(g)),u(w=>({...w,loading:!1}))}};return d.useEffect(()=>{x()},[]),e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{width:720,maxHeight:"80vh",background:"#151515",border:"1px solid #333",borderRadius:12,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid #2a2a2a",display:"flex",alignItems:"center",gap:10},children:[e.jsx("strong",{children:"Save workflow as…"}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsxs("button",{className:"btn",onClick:m,children:[e.jsx("i",{className:"fa fa-xmark"})," Close"]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:"1px solid #1f1f1f",display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("button",{className:"btn",disabled:!l.canUp,onClick:()=>x(l.cwd+"/.."),children:[e.jsx("i",{className:"fa fa-level-up-alt"})," Up"]}),e.jsx("div",{style:{fontFamily:"ui-monospace, Menlo, Consolas, monospace",fontSize:12,opacity:.9},children:l.cwd||"(loading…)"})]}),e.jsxs("div",{style:{display:"flex",gap:10,padding:12},children:[e.jsxs("div",{style:{flex:"0 0 45%",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Folders"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[l.loading?e.jsx("div",{style:{padding:12,opacity:.7},children:"Loading…"}):l.dirs.map(h=>e.jsxs("div",{className:"row",onDoubleClick:()=>x(h.path),style:{padding:"8px 12px",cursor:"pointer"},children:[e.jsx("i",{className:"fa fa-folder",style:{marginRight:8}})," ",h.name]},h.path)),!l.loading&&!l.dirs.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No subfolders"})]})]}),e.jsxs("div",{style:{flex:"1 1 auto",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Files"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[l.files.map(h=>e.jsxs("div",{className:"row",onClick:()=>u(g=>({...g,filename:h.name})),style:{padding:"8px 12px",cursor:"pointer",display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("i",{className:"fa fa-file",style:{marginRight:8}})," ",h.name]}),e.jsx("div",{style:{opacity:.6,fontSize:12},children:h.size})]},h.path)),!l.files.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No files"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"10px 14px",borderTop:"1px solid #2a2a2a"},children:[e.jsx("label",{style:{fontSize:12,opacity:.8},children:"Filename"}),e.jsx("input",{value:l.filename,onChange:h=>u(g=>({...g,filename:h.target.value})),style:{flex:1,background:"#111",border:"1px solid #333",borderRadius:6,color:"#ddd",padding:"8px 10px",fontFamily:"ui-monospace, Menlo, Consolas, monospace"}}),e.jsxs("button",{className:"btn",onClick:()=>{const h=l.filename.endsWith(".json")?l.filename:`${l.filename}.json`;a({dirPath:l.cwd,filename:h})},children:[e.jsx("i",{className:"fa fa-save"})," Save"]})]}),c&&e.jsx("div",{style:{padding:"6px 14px",color:"#f88"},children:String(c)})]})})}function He(){if(document.getElementById("fa-cdn"))return;const r=document.createElement("link");r.id="fa-cdn",r.rel="stylesheet",r.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css",document.head.appendChild(r)}function Ue(){const r=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",s=window.wpApiSettings&&window.wpApiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:r.replace(/\/$/,""),nonce:s}}async function ze(){try{const l=await G(()=>import("./chunks/api-DaHWQA7t.js"),[]),u=l.getNodesManifest||l.default&&l.default.getNodesManifest;if(typeof u=="function"){const c=await u();return Array.isArray(c)?c:[]}}catch{}const{root:r,nonce:s}=Ue(),a=await fetch(`${r}/yolandi/v1/nodes`,{credentials:"same-origin",headers:s?{"X-WP-Nonce":s}:{}});if(!a.ok)throw new Error(`Nodes fetch failed: ${a.status}`);const m=await a.json();return Array.isArray(m)?m:[]}function Oe(){const r=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",s=window.wpApiSettings&&window.wp.apiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:r.replace(/\/$/,""),nonce:s}}function oe(){const{root:r}=Oe();return`${r}/yolandi/v1`}function de(){const{nonce:r}=Oe();return r?{"Content-Type":"application/json","X-WP-Nonce":r}:{"Content-Type":"application/json"}}async function Xe(r,{settings:s={},env:a={},scriptSlug:m="workflow",scriptVersion:l="1"}={}){const u=await fetch(`${oe()}/jobs/enqueue`,{method:"POST",headers:de(),credentials:"same-origin",body:JSON.stringify({script_slug:m,script_version:l,payload:{mode:"workflow",workflow:r,settings:s,env:a}})});if(!u.ok)throw new Error(`enqueue ${u.status}`);return u.json()}async function Ve(r){const s=await fetch(`${oe()}/jobs/${r}`,{headers:de(),credentials:"same-origin"});if(!s.ok)throw new Error(`get job ${s.status}`);return s.json()}async function je(r,s){const a=await fetch(`${oe()}/jobs/${r}/control`,{method:"POST",headers:de(),credentials:"same-origin",body:JSON.stringify({control:s})});if(!a.ok)throw new Error(`control ${a.status}`);return a.json().catch(()=>({}))}async function Ge(r){const s=await fetch(`${oe()}/jobs/${r}/cancel`,{method:"POST",headers:de(),credentials:"same-origin"});if(!s.ok)throw new Error(`cancel ${s.status}`);return s.json().catch(()=>({}))}function Ke({runnerId:r,nodesDir:s,runnerPath:a}={}){const m=oe(),l=r||`runner-${Math.random().toString(36).slice(2)}`,u=s||"/wp-content/plugins/yolandi/nodes",c=a||"/wp-content/plugins/yolandi/runner/pause-aware-runner.js",y=[`$env:YOLANDI_API="${m}"`,`$env:YOLANDI_NODES_DIR="${u}"`,`$env:YOLANDI_RUNNER_ID="${l}"`,`node "${c}"`].join(" ; "),x=[`YOLANDI_API='${m}'`,`YOLANDI_NODES_DIR='${u}'`,`YOLANDI_RUNNER_ID='${l}'`,`node '${c}'`].join(" ");return{ps:y,sh:x}}function Ze(r){return(s,a="DEBUG")=>{const m=document.querySelector(r);if(!m)return;const l=new Date().toLocaleTimeString();m.textContent+=`${m.textContent?`
`:""}[${l}] ${a} — ${s}`,m.parentElement.scrollTop=m.parentElement.scrollHeight}}function Qe(r){return s=>{const a=document.querySelector(r);if(!a)return;const m=new Date().toLocaleTimeString();a.textContent+=`${a.textContent?`
`:""}[${m}] ${s}`,a.parentElement.scrollTop=a.parentElement.scrollHeight}}function et(){const[r,s]=d.useState([]),[a,m]=d.useState(!0),[l,u]=d.useState("puppeteer"),[c,y]=d.useState([{id:"w1",title:"Workflow 1",dirty:!1}]),[x,h]=d.useState("w1"),[g,w]=d.useState({open:!1,json:null}),[N,C]=d.useState(!1),[I,Y]=d.useState(()=>{const n=localStorage.getItem("yolandi_token"),p=document.cookie.includes("yolandi_bypass=1");return{token:n,user:null,bypass:p,locked:!n&&!p}}),[R,D]=d.useState(null),[S,T]=d.useState(null),[P,Q]=d.useState(""),[B,ie]=d.useState(""),[ee,ue]=d.useState(100),q=d.useRef(null),M=Ze("#ystudio-terminal pre"),V=Qe("#ystudio-runner pre"),re=d.useRef(""),ne=d.useRef("w1"),W=d.useRef(Object.create(null));d.useEffect(()=>{He()},[]),d.useEffect(()=>{(async()=>{try{const n=await ze();s(n)}catch(n){M(`Failed to load nodes: ${(n==null?void 0:n.message)||n}`,"ERROR")}})()},[]),d.useEffect(()=>{const{ps:n,sh:p}=Ke({});Q(n),ie(p)},[]),d.useEffect(()=>{if(!R)return;let n=!1;const p=async()=>{try{const f=await Ve(R);T(f);const j=(f==null?void 0:f.status)||"queued";j!==re.current&&(V(`Job #${R} → ${j}`),re.current=j)}catch(f){V(`Poll error: ${f.message}`)}finally{n||setTimeout(p,2e3)}};return p(),()=>{n=!0}},[R]),d.useEffect(()=>{const n={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)},p=f=>f.map(j=>{try{return typeof j=="string"?j:JSON.stringify(j)}catch{return String(j)}}).join(" ");return console.log=(...f)=>{M(p(f),"INFO"),n.log(...f)},console.warn=(...f)=>{M(p(f),"WARN"),n.warn(...f)},console.error=(...f)=>{M(p(f),"ERROR"),n.error(...f)},()=>{console.log=n.log,console.warn=n.warn,console.error=n.error}},[]),d.useEffect(()=>{window.YOLANDI=window.YOLANDI||{},window.YOLANDI.log=M,window.YOLANDI.runnerLog=V,window.YOLANDI.actions=window.YOLANDI.actions||{},window.YOLANDI.actions.onNodeDrop=(n,p)=>{var f;if(I.locked){C(!0);return}(f=q.current)==null||f.addNodeByMeta(n,p)},window.YOLANDI.actions.onFileSave=E,window.YOLANDI.actions.onFileSaveAs=L,window.YOLANDI.devBypass=()=>{document.cookie="yolandi_bypass=1; max-age=86400; path=/",Y(n=>({...n,bypass:!0,locked:!1}))}},[I.locked]),d.useEffect(()=>{const n=p=>{p.ctrlKey&&p.key.toLowerCase()==="s"&&(p.preventDefault(),p.shiftKey?L():E())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)}),d.useEffect(()=>{let n=null;const p=()=>{var j,O;const f=(O=(j=q.current)==null?void 0:j.getZoom)==null?void 0:O.call(j);typeof f=="number"&&isFinite(f)&&ue(Math.round(f*100)),n=setTimeout(p,400)};return p(),()=>n&&clearTimeout(n)},[]);function Z(){var n;return((n=q.current)==null?void 0:n.exportJSON())||{nodes:[],links:[]}}function se(n){var p;(p=q.current)==null||p.importJSON(n||{nodes:[],links:[]})}d.useEffect(()=>{var p;const n=ne.current;if(n&&n!==x){try{const j=Z();W.current[n]={...W.current[n]||{},data:j}}catch(j){M(`Save active tab before switch failed: ${j.message}`,"WARN")}const f=((p=W.current[x])==null?void 0:p.data)||{nodes:[],links:[]};se(f)}ne.current=x},[x]),d.useEffect(()=>{var j,O;const n=q.current,p=()=>y(X=>X.map(K=>K.id===x?{...K,dirty:!0}:K));let f=null;return(j=n==null?void 0:n.onDirty)!=null&&j.subscribe?f=n.onDirty.subscribe(p):(O=n==null?void 0:n.onChange)!=null&&O.subscribe?f=n.onChange.subscribe(p):n!=null&&n.on&&(n.on("change",p),f=()=>{var X;return(X=n.off)==null?void 0:X.call(n,"change",p)}),()=>{typeof f=="function"&&f()}},[x]);async function ae(){try{const n=Z(),{id:p}=await Xe(n,{settings:{},env:{}});D(p),V(`Enqueued job #${p}`)}catch(n){V(`Enqueue failed: ${n.message}`),alert(`Enqueue failed: ${n.message}`)}}async function le(){if(R)try{await je(R,"pause"),V(`Pause requested for #${R}`)}catch(n){alert(n.message)}}async function i(){if(R)try{await je(R,"resume"),V(`Resume requested for #${R}`)}catch(n){alert(n.message)}}async function t(){if(R)try{await Ge(R),V(`Cancel requested for #${R}`)}catch(n){alert(n.message)}}const o=(S==null?void 0:S.status)==="paused",v=["succeeded","failed","canceled"].includes((S==null?void 0:S.status)||""),b=!!R&&!o&&!v;function k(n,p){var X;const f=String(n).replace(/^\/+/,"");let j=(((X=window==null?void 0:window.wpApiSettings)==null?void 0:X.root)||"").toString(),O;if(j&&/^https?:\/\//i.test(j)?O=new URL(j.replace(/\/+$/,"/")+f):O=new URL("/wp-json/"+f,window.location.origin),p)for(const[K,he]of Object.entries(p))he!=null&&O.searchParams.set(K,he);return O.toString()}async function $(n=null){const p=k("yolandi/v1/fs/ls",n?{path:n}:void 0),f=await fetch(p,{credentials:"include"});if(!f.ok)throw f.status===404?new Error("fs/ls 404 (install yolandi/v1/fs/ls route)"):new Error(`fs/ls HTTP ${f.status}`);return f.json()}async function A({path:n,name:p,json:f}){const j=k("yolandi/v1/fs/save"),O=await fetch(j,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,name:p,json:f})});if(!O.ok)throw O.status===404?new Error("fs/save 404 (install yolandi/v1/fs/save route)"):new Error(`fs/save HTTP ${O.status}`);return O.json()}async function E(){const n=Z(),p=JSON.stringify(n,null,2);c.find(j=>j.id===x);const f=W.current[x]||{};if(!f.path||!f.name)return L();try{await A({path:f.path,name:f.name,json:p}),y(j=>j.map(O=>O.id===x?{...O,dirty:!1}:O)),M(`Saved: ${f.path}/${f.name}`,"INFO")}catch(j){M(`Save failed: ${j.message}`,"ERROR"),alert("Save failed: "+j.message)}}function L(){const n=JSON.stringify(Z(),null,2);w({open:!0,json:n})}async function _({dirPath:n,filename:p}){try{await A({path:n,name:p,json:g.json}),W.current[x]={...W.current[x]||{},path:n,name:p},y(f=>f.map(j=>j.id===x?{...j,title:p.replace(/\.json$/i,""),dirty:!1}:j)),w({open:!1,json:null}),M(`Saved: ${n}/${p}`,"INFO")}catch(f){M(`Save As failed: ${f.message}`,"ERROR"),alert("Save As failed: "+f.message)}}function J(){const n=Z()||{},p=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),f=document.createElement("a");f.href=URL.createObjectURL(p),f.download=`yolandi-workflow-${Date.now()}.json`,f.click(),URL.revokeObjectURL(f.href)}function F(){document.getElementById("ystudio-import").click()}function te(n){var j;const p=(j=n.target.files)==null?void 0:j[0];if(!p)return;const f=new FileReader;f.onload=()=>{try{const O=JSON.parse(String(f.result));se(O),y(X=>X.map(K=>K.id===x?{...K,dirty:!0}:K)),M("Workflow imported","INFO")}catch(O){M("Import failed: "+((O==null?void 0:O.message)||O),"ERROR")}},f.readAsText(p),n.target.value=""}function H(){var n,p;(p=(n=q.current)==null?void 0:n.zoomIn)==null||p.call(n)}function U(){var n,p;(p=(n=q.current)==null?void 0:n.zoomOut)==null||p.call(n)}function z(){var n,p;(p=(n=q.current)==null?void 0:n.zoomFit)==null||p.call(n)}return e.jsxs("div",{id:"ystudio","data-palette":a?"open":"closed",children:[e.jsx("input",{id:"ystudio-import",type:"file",accept:"application/json",onChange:te,style:{display:"none"}}),e.jsx(Pe,{isRunning:b,isPaused:o,isTerminal:v,onPlayPause:()=>!R||v?ae():o?i():le(),onStop:t,onExport:J,onImport:F,log:M}),e.jsxs("div",{id:"ystudio-main",style:{paddingBottom:28},children:[e.jsx(Je,{activePanel:l,setActivePanel:u,paletteOpen:a,setPaletteOpen:m,manifest:r,log:M,auth:I}),e.jsxs("div",{id:"ystudio-editor",children:[e.jsxs("div",{className:"tabs",children:[c.map(n=>e.jsxs("div",{className:`tab ${n.id===x?"active":""}`,onClick:()=>h(n.id),children:[e.jsxs("span",{className:"name",children:[n.title,n.dirty?"*":""]}),e.jsx("button",{className:"close",onClick:p=>{if(p.stopPropagation(),n.id===x){const j=Z();W.current[n.id]={...W.current[n.id]||{},data:j}}y(j=>j.filter(O=>O.id!==n.id));const f=W.current;f[n.id]&&delete f[n.id],setTimeout(()=>{if(!document.querySelector(".tabs .tab")){const j="w"+Math.random().toString(36).slice(2,7);y([{id:j,title:"Untitled",dirty:!1}]),h(j),W.current[j]={data:{nodes:[],links:[]},path:null,name:null},se({nodes:[],links:[]})}},0)},children:e.jsx("i",{className:"fa fa-xmark"})})]},n.id)),e.jsx("button",{className:"tab add",onClick:()=>{const n="w"+Math.random().toString(36).slice(2,7);y(p=>[...p,{id:n,title:"Untitled",dirty:!0}]),W.current[n]={data:{nodes:[],links:[]},path:null,name:null},h(n)},title:"New Workflow",children:e.jsx("i",{className:"fa fa-plus"})})]}),e.jsxs("div",{id:"ystudio-editor-host",style:{position:"relative",flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"canvas-wrap",style:{position:"relative",flex:"1 1 auto",minHeight:0},children:[e.jsx(Me,{registerApi:n=>q.current=n}),e.jsxs("div",{style:{position:"absolute",top:10,right:10,display:"flex",gap:8,zIndex:20},children:[e.jsx("button",{className:"btn",title:"Zoom Out",onClick:U,children:e.jsx("i",{className:"fa fa-magnifying-glass-minus"})}),e.jsxs("div",{className:"btn",title:"Zoom",children:[ee,"%"]}),e.jsx("button",{className:"btn",title:"Zoom In",onClick:H,children:e.jsx("i",{className:"fa fa-magnifying-glass-plus"})}),e.jsx("button",{className:"btn",title:"Fit",onClick:z,children:e.jsx("i",{className:"fa fa-compress"})})]})]}),e.jsx(Fe,{jobId:R,job:S,runnerCmdPS:P,runnerCmdSH:B,onPlay:ae,onPause:le,onResume:i,onCancel:t})]})]})]}),N&&e.jsx(Be,{onClose:()=>C(!1),onLoggedIn:()=>C(!1)}),g.open&&e.jsx(qe,{initialPath:null,fsLs:$,onClose:()=>w({open:!1,json:null}),onConfirm:_}),e.jsxs("div",{id:"ystudio-statusbar",style:{position:"fixed",left:0,right:0,bottom:0,zIndex:30},children:[e.jsxs("div",{className:"left",children:[e.jsx("i",{className:"fa fa-code-branch"})," main ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-circle"})," Ready"]}),e.jsxs("div",{className:"right",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Job: ",R?(S==null?void 0:S.status)||"queued":"idle"," ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-rotate"})," Auto-save"]})]})]})}const tt=[{key:"scripts",label:"Scripts",Component:De},{key:"jobs",label:"Jobs",Component:_e},{key:"nodes",label:"Nodes",Component:Te},{key:"graph",label:"Graph",Component:et}];self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(r,s){switch(s){case"json":return new ke;case"css":return new Se;case"html":return new Ne;case"typescript":case"javascript":return new be;default:return new ve}}});function nt(){const{active:r}=Ce(tt,"scripts"),s=(r==null?void 0:r.Component)||(()=>e.jsx("div",{}));return e.jsxs("div",{style:{padding:12},children:[e.jsx("h1",{children:"YOLANDI Admin"}),e.jsx(s,{})]})}(function(){const s=document.getElementById("yolandi-root");if(!s)return;$e.createRoot(s).render(e.jsx(nt,{}))})();
