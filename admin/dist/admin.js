const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/vendor-Cu9HgnO8.js","chunks/vendor-react-Bifdz3QC.js","chunks/index-COnHatJ4.js","chunks/NodeTree-CX6rf2z9.js","chunks/index-BIJwCuMh.js","chunks/index-FIUVNo2M.js"])))=>i.map(i=>d[i]);
import{a as f,j as e}from"./chunks/vendor-react-Bifdz3QC.js";import{W as ve,a as be,b as Ne,c as Se,d as ke,_ as V,e as Ce}from"./chunks/vendor-Cu9HgnO8.js";function fe(){const a=(window.location.hash||"").replace(/^#\/?/,""),[i,...r]=a.split("/");return{key:i||"",rest:r.join("/")}}function Re(a,i=""){const r=f.useMemo(()=>a.reduce((u,y)=>(u[y.key]=y,u),{}),[a]),[m,l]=f.useState(()=>{const{key:u}=fe();return r[u]?u:i});f.useEffect(()=>{const u=()=>{const{key:y}=fe();l(r[y]?y:i)};return window.addEventListener("hashchange",u),()=>window.removeEventListener("hashchange",u)},[r,i]);const p=u=>{r[u]&&fe().key!==u&&(window.location.hash=`#/${u}`)};return{routeKey:m,active:r[m],navigate:p}}const xe=window.YOLANDI_CONFIG||{},ye=window.location.origin.replace(/\/$/,""),Ae=[(xe.restRoot||"").replace(/\/$/,""),(xe.restRootQuery||"").replace(/\/$/,""),`${ye}/index.php?rest_route=/yolandi/v1`,`${ye}/wp-json/yolandi/v1`].filter(Boolean);Ae[0];function Ie(){let a=window.YOLANDI_BOOT&&window.YOLANDI_BOOT.restBase||"";if(!a){const i=document.querySelector('link[rel="https://api.w.org"]');i!=null&&i.href&&(a=i.href.replace(/\/$/,"")+"/yolandi/v1")}return a||(a="/wp-json/yolandi/v1"),a.replace(/\/$/,"")}async function ge(a,i={}){var h,x;const r={"Content-Type":"application/json","X-WP-Nonce":((h=window==null?void 0:window.YOLANDI_BOOT)==null?void 0:h.nonce)||((x=window==null?void 0:window.wpApiSettings)==null?void 0:x.nonce)||"",...i.headers||{}},m={credentials:"same-origin",...i,headers:r};m.body&&typeof m.body!="string"&&!(m.body instanceof FormData)&&(m.body=JSON.stringify(m.body));const l=await fetch(a,m),p=await l.text(),u=(l.headers.get("content-type")||"").includes("application/json"),y=u?p?JSON.parse(p):null:p;return{resp:l,isJson:u,body:y,text:p}}async function he(a,i={}){const r=Ie(),m=a.startsWith("/")?a:`/${a}`,l=`${r}${m}`,p={...i};p.body!=null&&typeof p.body!="string"&&!(p.body instanceof FormData)&&(p.body=JSON.stringify(p.body));let{resp:u,isJson:y,body:h}=await ge(l,p);const x=typeof h=="string"&&h.trim().startsWith("<!DOCTYPE");if((!u.ok||x)&&!p.__fallbackTried){const g=`${l.replace(r,"")}`.replace(/^\//,""),w=`${window.location.origin}/index.php?rest_route=/yolandi/v1/${g}`,N=await ge(w,{...p,__fallbackTried:!0});u=N.resp,y=N.isJson,h=N.body}if(!u.ok){const g=new Error(`API ${u.status} ${u.statusText}`);throw g.status=u.status,g.url=u.url,g.body=h,g}if(!y||h==null){const g=new Error("API returned non-JSON response");throw g.url=u.url,g.body=h,g}return h}self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(a,i){switch(i){case"json":return new ke;case"css":return new Se;case"html":return new Ne;case"typescript":case"javascript":return new be;default:return new ve}}});async function Le(){const a=await V(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.m),__vite__mapDeps([0,1]));return await Promise.all([V(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.f),__vite__mapDeps([0,1])),V(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.g),__vite__mapDeps([0,1])),V(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.h),__vite__mapDeps([0,1])),V(()=>import("./chunks/vendor-Cu9HgnO8.js").then(i=>i.i),__vite__mapDeps([0,1]))]),a}function De(a="{}"){const i=f.useRef(null),[r,m]=f.useState(a);return f.useEffect(()=>{let l;return(async()=>{try{l=(await Le()).editor.create(i.current,{value:a,language:"json",automaticLayout:!0,minimap:{enabled:!1}}),l.onDidChangeModelContent(()=>m(l.getValue()))}catch{if(i.current){const p=document.createElement("textarea");p.value=a,p.style.width="100%",p.style.height="260px",p.addEventListener("input",()=>m(p.value)),i.current.appendChild(p)}}})(),()=>{var p;return(p=l==null?void 0:l.dispose)==null?void 0:p.call(l)}},[]),[i,r,m]}function _e(){const[a,i]=f.useState("example-search"),[r,m]=f.useState(1),[l,p]=f.useState('{ "q": "hello" }'),[u,y]=De(`{
  "nodes": [
    { "id": "n1", "type": "SetDevice", "props": { "profile": "Pixel7" } },
    { "id": "n2", "type": "ProxyDirector", "props": { "director": "webshare-main", "sessionSeed": "\${jobId}" } },
    { "id": "n3", "type": "Navigate", "props": { "url": "https://example.com" } },
    { "id": "n4", "type": "Screenshot", "props": { "path": "\${artifacts}/shot.png", "fullPage": true } }
  ],
  "edges": [ { "from": "n1", "to": "n2" }, { "from": "n2", "to": "n3" }, { "from": "n3", "to": "n4" } ],
  "meta": { "slug": "example-search", "version": 1 }
}`);async function h(){let x;try{x=JSON.parse(y)}catch{alert("Invalid JSON graph");return}const g={script_slug:a,script_version:Number(r),params:JSON.parse(l||"{}"),priority:5},w=await he("/jobs/enqueue",{method:"POST",body:g});w!=null&&w.id?alert(`Enqueued Job #${w.id}`):alert("Failed to enqueue")}return e.jsxs("div",{children:[e.jsx("h2",{children:"Script JSON"}),e.jsx("div",{ref:u,style:{border:"1px solid #ccd0d4",height:280}}),e.jsx("h3",{style:{marginTop:16},children:"Run Parameters"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Slug: ",e.jsx("input",{value:a,onChange:x=>i(x.target.value)})]}),e.jsxs("label",{children:["Version: ",e.jsx("input",{type:"number",min:1,value:r,onChange:x=>m(x.target.value),style:{width:80}})]})]}),e.jsx("textarea",{value:l,onChange:x=>p(x.target.value),style:{width:"100%",height:120,marginTop:8}}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("button",{className:"button button-primary",onClick:h,children:"Enqueue Test Run"}),e.jsxs("span",{style:{marginLeft:8,color:"#555"},children:["Posts to ",e.jsx("code",{children:"/jobs/enqueue"}),". Save graphs under ",e.jsx("code",{children:"scripts/<slug>/vNNN.json"}),"."]})]})]})}function Te(){const[a,i]=f.useState(0),[r,m]=f.useState(null),[l,p]=f.useState(!1);async function u(){if(!a)return;p(!0);const y=await he(`/jobs/${a}`);m(y||null),p(!1)}return e.jsxs("div",{children:[e.jsx("h2",{children:"Jobs"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("label",{children:["Job ID: ",e.jsx("input",{type:"number",value:a,onChange:y=>i(Number(y.target.value))})]}),e.jsx("button",{className:"button",onClick:u,children:"Load"})]}),l?e.jsx("p",{children:"Loading…"}):null,r?e.jsxs("div",{style:{marginTop:12},children:[e.jsx("table",{className:"widefat fixed striped",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("td",{children:r.id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("td",{children:r.status})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Script"}),e.jsxs("td",{children:[r.script_slug," v",r.script_version]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Attempts"}),e.jsxs("td",{children:[r.attempts," / ",r.max_attempts]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Runner"}),e.jsx("td",{children:r.runner_id||""})]})]})}),r.artifacts?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Artifacts"}),e.jsx("pre",{style:{background:"#f6f7f7",padding:8,whiteSpace:"pre-wrap"},children:JSON.stringify(r.artifacts,null,2)})]}):null,r.error?e.jsxs("div",{style:{marginTop:8},children:[e.jsx("h3",{children:"Error"}),e.jsx("pre",{style:{background:"#fff4f4",padding:8,color:"#a00"},children:JSON.stringify(r.error,null,2)})]}):null]}):null]})}function Me(){const[a,i]=f.useState([]),[r,m]=f.useState(!1),[l,p]=f.useState("");return f.useEffect(()=>{let u=!0;return m(!0),he("/nodes").then(y=>{u&&(Array.isArray(y)?i(y):p(String(y||"")))}).finally(()=>u&&m(!1)),()=>u=!1},[]),e.jsxs("div",{children:[e.jsx("h2",{children:"Nodes"}),r?e.jsx("p",{children:"Loading…"}):null,l&&e.jsx("p",{style:{color:"#a00"},children:l}),e.jsxs("table",{className:"widefat fixed striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Version"})]})}),e.jsx("tbody",{children:a.map(u=>{var y,h,x,g;return e.jsxs("tr",{children:[e.jsx("td",{children:u.path}),e.jsx("td",{children:((y=u.meta)==null?void 0:y.type)||"?"}),e.jsx("td",{children:((h=u.meta)==null?void 0:h.title)||""}),e.jsx("td",{children:((x=u.meta)==null?void 0:x.category)||""}),e.jsx("td",{children:((g=u.meta)==null?void 0:g.version)||""})]},u.path)})})]}),e.jsxs("p",{style:{marginTop:8},children:["Add custom nodes by dropping ",e.jsx("code",{children:".mjs"})," files into"," ",e.jsx("code",{children:"wp-content/plugins/yolandi/nodes/"}),", then reload this page."]})]})}const we=()=>Math.random().toString(36).slice(2,9);function Pe({registerApi:a}){function i(s,t,o){return`${s}:${t}:${o}`}function r(s,t,o){const j=document.querySelector(`[data-port-key="${i(s,t,o)}"] .dot`)||document.querySelector(`[data-port-key="${i(s,t,o)}"]`);if(!j)return null;const b=j.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top+b.height/2}}const m=280,l=28,p=22,u=f.useRef(null),y=f.useRef(null),[h,x]=f.useState([]),[g,w]=f.useState([]),[N,$]=f.useState({x:0,y:0,k:1}),[L,W]=f.useState("select"),[R,D]=f.useState(null),[k,M]=f.useState(null),[Y,G]=f.useState(null),Z=.3,pe=2,U=(s,t)=>{const o=u.current.getBoundingClientRect();return{x:(s-o.left-N.x)/N.k,y:(t-o.top-N.y)/N.k}},ne=s=>h.find(t=>t.id===s);f.useEffect(()=>{const s={addNodeByMeta(t,o){var T,F,K;const{x:j,y:b}=U(o.x,o.y),S="n"+we(),O=(t==null?void 0:t.title)||(t==null?void 0:t.type)||"Node",A=(t==null?void 0:t.props)||{},E={};for(const[n,c]of Object.entries(A))E[n]=(T=c==null?void 0:c.default)!=null?T:"";const I=(((F=t==null?void 0:t.io)==null?void 0:F.inputs)||["in"]).map((n,c)=>({id:"i"+c,name:n})),_=(((K=t==null?void 0:t.io)==null?void 0:K.outputs)||["out"]).map((n,c)=>({id:"o"+c,name:n}));x(n=>[...n,{id:S,x:Math.round(j-m/2),y:Math.round(b-16),w:m,title:O,meta:t,fields:E,inputs:I,outputs:_,selected:!1}])},exportJSON(){return{version:1,view:N,nodes:h.map(t=>{var o;return{id:t.id,title:t.title,type:((o=t.meta)==null?void 0:o.type)||null,x:t.x,y:t.y,w:t.w,fields:t.fields,inputs:t.inputs,outputs:t.outputs}}),links:g}},importJSON(t){!t||!Array.isArray(t.nodes)||($(t.view||{x:0,y:0,k:1}),x(t.nodes.map(o=>({id:o.id,title:o.title||"Node",meta:{type:o.type||"Imported"},x:o.x,y:o.y,w:o.w||m,fields:o.fields||{},inputs:o.inputs||[{id:"i0",name:"in"}],outputs:o.outputs||[{id:"o0",name:"out"}],selected:!1}))),w(Array.isArray(t.links)?t.links:[]))},setMode:W};a==null||a(s),window.YOLANDI=window.YOLANDI||{},window.YOLANDI.exportWorkflow=()=>s.exportJSON(),window.YOLANDI.importWorkflow=t=>s.importJSON(t)},[h,g,N,a]);const J=(s,t,o)=>{const j=r(s,t,o);if(!j)return null;const b=u.current.getBoundingClientRect();return{x:(j.x-b.left-N.x)/N.k,y:(j.y-b.top-N.y)/N.k}},P=f.useMemo(()=>{const s=[];for(const t of g){const o=J("out",t.from.nid,t.from.pid),j=J("in",t.to.nid,t.to.pid);if(!o||!j)continue;const b=Math.max(40,Math.abs(j.x-o.x)*.6);s.push({id:t.id,d:`M ${o.x},${o.y} C ${o.x+b},${o.y} ${j.x-b},${j.y} ${j.x},${j.y}`})}if(k){const t=J("out",k.from.nid,k.from.pid),o=U(k.x,k.y);if(t&&o){const j=Math.max(40,Math.abs(o.x-t.x)*.6);s.push({id:"_wip",d:`M ${t.x},${t.y} C ${t.x+j},${t.y} ${o.x-j},${o.y} ${o.x},${o.y}`})}}return s},[g,k,h,N]);function z(s,t){$(o=>{const S=Math.min(2,Math.max(.3,o.k*s));if(!t)return{...o,k:S};const O=u.current.getBoundingClientRect(),A=(t.x-O.left-o.x)/o.k,E=(t.y-O.top-o.y)/o.k,I=t.x-O.left-A*S,_=t.y-O.top-E*S;return{x:I,y:_,k:S}})}f.useEffect(()=>{const s=u.current;if(!s)return;const t=o=>{o.ctrlKey?(o.preventDefault(),z(o.deltaY<0?1.1:1/1.1,{x:o.clientX,y:o.clientY})):L==="pan"&&(o.preventDefault(),$(j=>({...j,x:j.x-o.deltaX,y:j.y-o.deltaY})))};return s.addEventListener("wheel",t,{passive:!1}),()=>s.removeEventListener("wheel",t)},[L]);function se(s){var S,O,A,E;if((O=(S=s.target).closest)!=null&&O.call(S,".yc-node")||(E=(A=s.target).closest)!=null&&E.call(A,".yc-port"))return;if(L==="pan"||s.button===1){const I={sx:s.clientX,sy:s.clientY,vx:N.x,vy:N.y},_=F=>$({x:I.vx+(F.clientX-I.sx),y:I.vy+(F.clientY-I.sy),k:N.k}),T=()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",T)};window.addEventListener("mousemove",_),window.addEventListener("mouseup",T);return}const t=U(s.clientX,s.clientY);let o={sx:t.x,sy:t.y,ex:t.x,ey:t.y,sxScr:s.clientX,syScr:s.clientY,exScr:s.clientX,eyScr:s.clientY};G(o);const j=I=>{const _=U(I.clientX,I.clientY);o={...o,ex:_.x,ey:_.y,exScr:I.clientX,eyScr:I.clientY},G(o);const T=Math.min(o.sx,o.ex),F=Math.min(o.sy,o.ey),K=Math.max(o.sx,o.ex),n=Math.max(o.sy,o.ey);x(c=>c.map(d=>{const v=l+8+Math.max(d.inputs.length,d.outputs.length)*p+12+Object.keys(d.fields).length*(p+4),C=d.x,q=d.y,H=d.x+d.w,ce=d.y+v,$e=!(H<T||C>K||ce<F||q>n);return{...d,selected:$e}}))},b=()=>{G(null),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",b)};window.addEventListener("mousemove",j),window.addEventListener("mouseup",b)}function oe(s,t){s.button===0&&X(s,t)}function B(s,t){if(s.button!==0)return;const o=s.target.tagName;["INPUT","SELECT","TEXTAREA","BUTTON"].includes(o)||s.target.closest(".yc-port")||X(s,t)}function X(s,t){if(!ne(t))return;const j=h.filter(A=>A.selected).map(A=>A.id),b=j.length?j:[t],S=U(s.clientX,s.clientY),O=b.map(A=>{const E=ne(A);return{id:A,dx:S.x-E.x,dy:S.y-E.y}});D({ids:b,offsets:O}),s.stopPropagation()}f.useEffect(()=>{const s=o=>{if(!R)return;const j=U(o.clientX,o.clientY);x(b=>b.map(S=>{const O=R.offsets.find(A=>A.id===S.id);return O?{...S,x:Math.round(j.x-O.dx),y:Math.round(j.y-O.dy)}:S}))},t=()=>D(null);return window.addEventListener("mousemove",s),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",t)}},[R]);function Q(s,t,o){const j=document.querySelector(`[data-port-key="out:${s}:${t}"] .dot`);if(!j)return;const b=j.getBoundingClientRect();M({from:{nid:s,pid:t},x:b.left+b.width/2,y:b.top+b.height/2}),o.stopPropagation()}function ie(s){k&&M(t=>({...t,x:s.clientX,y:s.clientY}))}function ae(s,t){const o=Array.from(document.querySelectorAll(".yc-port.in"));let j=null,b=256;for(const S of o){const O=S.getAttribute("data-port-key"),[,A,E]=O.split(":"),I=J("in",A,E);if(!I)continue;const _=I.x-s,T=I.y-t,F=_*_+T*T;F<b&&(b=F,j={nid:A,pid:E})}return j}function re(s,t,o){if(!k)return;if(!s||!t){const S=U(o.clientX,o.clientY),O=ae(S.x,S.y);O&&(s=O.nid,t=O.pid)}if(!s||!t){M(null);return}const b={id:"l"+we(),from:k.from,to:{nid:s,pid:t}};w(S=>[...S.filter(O=>!(O.to.nid===s&&O.to.pid===t)),b]),M(null),o.stopPropagation()}function le(){k&&M(null)}function ee(){if(!h.length){$({x:0,y:0,k:1});return}const s=60;let t=1/0,o=1/0,j=-1/0,b=-1/0;for(const T of h){const F=l+8+Math.max(T.inputs.length,T.outputs.length)*p+12+Object.keys(T.fields).length*(p+4);t=Math.min(t,T.x),j=Math.max(j,T.x+T.w),o=Math.min(o,T.y),b=Math.max(b,T.y+F)}const S=u.current.getBoundingClientRect(),O=S.width-s*2,A=S.height-s*2,E=Math.min(pe,Math.max(Z,Math.min(O/(j-t),A/(b-o)))),I=s-t*E+(S.width-(j-t)*E-s*2)/2,_=s-o*E+(S.height-(b-o)*E-s*2)/2;$({x:I,y:_,k:E})}return e.jsxs("div",{id:"yc-canvas",ref:u,style:{position:"absolute",inset:0},onMouseMove:ie,onMouseUp:le,onMouseDown:se,onDragOver:s=>{var t,o;(o=(t=s.dataTransfer)==null?void 0:t.types)!=null&&o.includes("application/x-yolandi-node")&&(s.preventDefault(),s.dataTransfer.dropEffect="copy")},onDrop:s=>{var j,b,S;const t=(j=s.dataTransfer)==null?void 0:j.getData("application/x-yolandi-node");if(!t)return;s.preventDefault(),s.stopPropagation();const o=JSON.parse(t);(S=(b=window.YOLANDI.actions).onNodeDrop)==null||S.call(b,o,{x:s.clientX,y:s.clientY})},children:[e.jsxs("div",{className:"yc-toolbar",style:{position:"absolute",right:12,top:8,zIndex:20,display:"flex",gap:6,alignItems:"center"},children:[e.jsx("button",{title:"Pan",onClick:()=>W(s=>s==="pan"?"select":"pan"),children:e.jsx("i",{className:"fa fa-hand"})}),e.jsx("span",{className:"sep"}),e.jsx("button",{title:"Fit",onClick:ee,children:e.jsx("i",{className:"fa fa-rectangle-list"})}),e.jsxs("span",{className:"zoom",children:[" ",N.k*100|0,"%"]})]}),e.jsxs("div",{ref:y,className:"yc-content",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",transformOrigin:"0 0",transform:`translate(${N.x}px, ${N.y}px) scale(${N.k})`},children:[e.jsx("svg",{className:"yc-wires",width:"20000",height:"12000",style:{position:"absolute",left:0,top:0,overflow:"visible",pointerEvents:"none",zIndex:0},children:P.map(s=>e.jsx("path",{d:s.d,className:s.id==="_wip"?"yc-wire wip":"yc-wire",stroke:s.id==="_wip"?"rgba(96,165,250,.7)":"rgba(96,165,250,.95)",strokeWidth:2,fill:"none",style:{vectorEffect:"non-scaling-stroke"}},s.id))}),h.map(s=>e.jsxs("div",{className:`yc-node ${s.selected?"selected":""}`,style:{left:s.x,top:s.y,width:s.w,position:"absolute",zIndex:1},onMouseDown:t=>B(t,s.id),children:[e.jsxs("div",{className:"yc-head",onMouseDown:t=>oe(t,s.id),title:s.title,children:[e.jsx("i",{className:"fa fa-grip-lines"}),e.jsx("span",{children:s.title})]}),e.jsxs("div",{className:"yc-ports",children:[e.jsx("div",{className:"col in",children:s.inputs.map(t=>e.jsxs("div",{className:"yc-port in","data-port-key":`in:${s.id}:${t.id}`,onMouseUp:o=>re(s.id,t.id,o),children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"name",children:t.name})]},t.id))}),e.jsx("div",{className:"col out",children:s.outputs.map(t=>e.jsxs("div",{className:"yc-port out","data-port-key":`out:${s.id}:${t.id}`,onMouseDown:o=>Q(s.id,t.id,o),children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"dot"})]},t.id))})]}),e.jsx("div",{className:"yc-body",children:Object.entries(s.fields).map(([t,o])=>{var O,A;const j=((A=(O=s.meta)==null?void 0:O.props)==null?void 0:A[t])||{type:"string"},b=(j.type||"string").toLowerCase(),S=E=>x(I=>I.map(_=>_.id===s.id?{..._,fields:{..._.fields,[t]:E}}:_));return["bool","boolean","checkbox"].includes(b)?e.jsxs("label",{className:"row check",children:[e.jsx("input",{type:"checkbox",checked:!!o,onChange:E=>S(E.target.checked)}),e.jsx("span",{className:"lab",children:t})]},t):b==="number"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"number",value:o!=null?o:"",onChange:E=>S(E.target.value===""?"":Number(E.target.value))})]},t):b==="select"?e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("select",{value:o!=null?o:"",onChange:E=>S(E.target.value),children:(j.options||[]).map(E=>e.jsx("option",{value:E,children:String(E)},String(E)))})]},t):e.jsxs("label",{className:"row",children:[e.jsx("span",{className:"lab",children:t}),e.jsx("input",{type:"text",value:o!=null?o:"",onChange:E=>S(E.target.value)})]},t)})})]},s.id))]}),Y&&e.jsx("div",{className:"yc-marquee",style:{position:"fixed",border:"1px dashed rgba(96,165,250,.9)",background:"rgba(96,165,250,.12)",pointerEvents:"none",zIndex:10,left:Math.min(Y.sxScr,Y.exScr),top:Math.min(Y.syScr,Y.eyScr),width:Math.abs(Y.exScr-Y.sxScr),height:Math.abs(Y.eyScr-Y.syScr)}})]})}function Ye({isRunning:a,isPaused:i,isTerminal:r,onPlayPause:m,onStop:l,onExport:p,onImport:u,log:y}){const[h,x]=f.useState(null),g=f.useRef(null),w=f.useRef(null);f.useEffect(()=>{const D=M=>{g.current&&(g.current.contains(M.target)||x(null))},k=M=>{M.key==="Escape"&&x(null)};return document.addEventListener("mousedown",D),window.addEventListener("keydown",k),()=>{document.removeEventListener("mousedown",D),window.removeEventListener("keydown",k)}},[]);const N=D=>()=>{clearTimeout(w.current),w.current=setTimeout(()=>x(D),80)},$=()=>{clearTimeout(w.current),w.current=setTimeout(()=>x(null),150)},L=D=>k=>{k.preventDefault(),k.stopPropagation(),x(M=>M===D?null:D)},W=()=>{var D,k;(k=(D=window==null?void 0:window.YOLANDI)==null?void 0:D.actions)!=null&&k.onFileSave?(window.YOLANDI.actions.onFileSave(),x(null)):y==null||y("Save not available (GraphApp actions missing)","WARN")},R=()=>{var D,k;(k=(D=window==null?void 0:window.YOLANDI)==null?void 0:D.actions)!=null&&k.onFileSaveAs?(window.YOLANDI.actions.onFileSaveAs(),x(null)):y==null||y("Save As not available (GraphApp actions missing)","WARN")};return e.jsxs("div",{ref:g,className:"ystudio-menubar",style:{position:"relative",zIndex:50,display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderBottom:"1px solid #222",background:"#121212"},children:[e.jsxs(me,{id:"file",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-file"})," File"]}),open:h==="file",onHoverOpen:N("file"),onHoverClose:$,onClickToggle:L("file"),children:[e.jsx(de,{icon:"fa-save",label:"Save",onClick:W}),e.jsx(de,{icon:"fa-file-export",label:"Save as…",onClick:R}),e.jsx(We,{}),e.jsx(de,{icon:"fa-download",label:"Export (.json)",onClick:()=>{x(null),p==null||p()}}),e.jsx(de,{icon:"fa-upload",label:"Import (.json)",onClick:()=>{x(null),u==null||u()}})]}),e.jsx(me,{id:"nodes",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-diagram-project"})," Nodes"]}),open:h==="nodes",onHoverOpen:N("nodes"),onHoverClose:$,onClickToggle:L("nodes"),children:e.jsx("div",{className:"menu-note",children:"Drop nodes from the sidebar palette."})}),e.jsx(me,{id:"help",label:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-circle-question"})," Help"]}),open:h==="help",onHoverOpen:N("help"),onHoverClose:$,onClickToggle:L("help"),children:e.jsx("div",{className:"menu-note",children:"Ctrl+S: Save  •  Ctrl+Shift+S: Save as…"})}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{className:"btn",title:i?"Resume":a?"Pause":"Run",onClick:m,children:i?e.jsx("i",{className:"fa fa-play"}):a?e.jsx("i",{className:"fa fa-pause"}):e.jsx("i",{className:"fa fa-play"})}),e.jsx("button",{className:"btn",title:"Stop",onClick:l,children:e.jsx("i",{className:"fa fa-stop"})})]}),e.jsx("style",{children:`
        .btn {
          background:#2b2b2b;border:1px solid #3a3a3a;border-radius:6px;
          padding:6px 10px;color:#ddd;cursor:pointer;line-height:1;
        }
        .btn:hover { background:#333; }
        .menu-root {
          position: relative;
        }
        .menu-button {
          border: none; background: transparent; color:#ddd; cursor: pointer;
          border-radius: 6px; padding:6px 10px; display:flex; align-items:center; gap:6px;
        }
        .menu-button:hover, .menu-root[aria-expanded="true"] .menu-button {
          background:#1e1e1e;
        }
        .menu-popover {
          position: absolute; top: calc(100% + 4px); left: 0;
          background:#1b1b1b; border:1px solid #333; border-radius:8px;
          min-width: 220px; padding: 6px; z-index: 200;
          box-shadow: 0 6px 24px rgba(0,0,0,0.35);
        }
        .menu-item {
          display:flex; align-items:center; gap:8px;
          width:100%; border:none; background:transparent; color:#ddd;
          padding:8px 10px; border-radius:6px; cursor:pointer; text-align:left;
        }
        .menu-item:hover { background:#2b2b2b; }
        .menu-sep { height:1px; background:#2a2a2a; margin:6px 4px; }
        .menu-note { padding:8px 10px; font-size:12px; opacity:0.8; }
      `})]})}function me({id:a,label:i,open:r,onHoverOpen:m,onHoverClose:l,onClickToggle:p,children:u}){return e.jsxs("div",{className:"menu-root","aria-expanded":r?"true":"false",onMouseEnter:m,onMouseLeave:l,children:[e.jsxs("button",{type:"button",className:"menu-button",onClick:p,children:[i," ",e.jsx("i",{className:"fa fa-caret-down"})]}),r&&e.jsx("div",{className:"menu-popover",role:"menu","aria-labelledby":a,children:u})]})}function de({icon:a,label:i,onClick:r}){return e.jsxs("button",{type:"button",className:"menu-item",onClick:r,children:[a?e.jsx("i",{className:`fa ${a}`}):null,e.jsx("span",{children:i})]})}function We(){return e.jsx("div",{className:"menu-sep","aria-hidden":"true"})}const Ee=Object.assign({"../activity/loop/index.jsx":()=>V(()=>import("./chunks/index-COnHatJ4.js"),__vite__mapDeps([2,1,3])),"../activity/puppeteer/index.jsx":()=>V(()=>import("./chunks/index-BIJwCuMh.js"),__vite__mapDeps([4,1,3])),"../activity/shop/index.jsx":()=>V(()=>import("./chunks/index-FIUVNo2M.js"),__vite__mapDeps([5,1]))});console.log(Ee);function Je({manifest:a,log:i,auth:r}){const[m,l]=f.useState([]);f.useEffect(()=>{let u=!1;return(async()=>{const y=[];for(const[h,x]of Object.entries(Ee))try{const g=await x(),w=g.meta||{},$=(g.create||(()=>({id:"x",title:"Unknown",icon:"fa-cube",render:()=>null})))({manifest:a,log:i,auth:r});y.push({id:w.id||$.id,title:w.title||$.title,icon:w.icon||$.icon,render:$.render})}catch(g){console.warn("Activity load failed",h,g)}u||l(y)})(),()=>{u=!0}},[a,i,r]);const p=f.useMemo(()=>m.length?[]:[{id:"puppeteer",title:"Puppeteer",icon:"fa-angle",render:()=>e.jsxs("div",{style:{padding:8,color:"#bbb",fontSize:12},children:["No activity plugins found. Add files under ",e.jsx("code",{children:"admin/activity/*/index.jsx"}),"."]})}],[m]);return m.length?m:p}function Fe({activePanel:a,setActivePanel:i,paletteOpen:r,setPaletteOpen:m,manifest:l,log:p,auth:u}){var x,g;const y=Je({manifest:l,log:p,auth:u}),h=()=>m(!r);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"ystudio-activity",children:y.map(w=>e.jsx("button",{className:`activity-btn ${a===w.id?"active":""}`,title:w.title,onClick:()=>{a===w.id?h():(r||h(),i(w.id))},children:e.jsx("i",{className:`fa ${w.icon}`})},w.id))}),e.jsxs("div",{id:"ystudio-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("span",{className:"label",children:((x=y.find(w=>w.id===a))==null?void 0:x.title)||"Panel"}),e.jsx("button",{className:"icon-btn",onClick:h,title:"Toggle Sidebar",children:e.jsx("i",{className:"fa fa-spider"})})]}),e.jsx("div",{className:"palette-scroll",children:(g=y.find(w=>w.id===a))==null?void 0:g.render()})]})]})}function Be({jobId:a,job:i,runnerCmdPS:r,runnerCmdSH:m,onPlay:l,onPause:p,onResume:u,onCancel:y}){var N;const h=f.useRef(null),x=f.useRef(null);f.useEffect(()=>{const $=x.current,L=h.current;if(!$||!L)return;let W=0,R=0;const D=Y=>{W=Y.clientY,R=L.getBoundingClientRect().height,document.addEventListener("mousemove",k),document.addEventListener("mouseup",M)},k=Y=>{const G=W-Y.clientY,Z=Math.max(120,R+G);L.style.setProperty("--panel-height",`${Z}px`)},M=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",M)};return $.addEventListener("mousedown",D),()=>$.removeEventListener("mousedown",D)},[]);const g=(i==null?void 0:i.status)==="paused",w=["succeeded","failed","canceled"].includes((i==null?void 0:i.status)||"");return e.jsxs("div",{id:"ystudio-panel",ref:h,style:{"--panel-height":"220px",height:"var(--panel-height)",minHeight:120,overflow:"hidden",flex:"0 0 auto"},children:[e.jsxs("div",{id:"ystudio-panel-tabs",children:[e.jsxs("div",{className:"tab active",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Runner"]}),e.jsx("div",{className:"spacer"}),e.jsx("div",{className:"controls"})]}),e.jsx("div",{id:"ystudio-panel-body",style:{height:"calc(var(--panel-height) - 32px)",overflow:"auto"},children:e.jsxs("div",{id:"ystudio-runner",children:[e.jsxs("div",{className:"runner-help",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Windows PowerShell)"}),e.jsx("textarea",{readOnly:!0,value:r,onFocus:$=>$.target.select(),rows:3,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Launch Runner (Linux/macOS)"}),e.jsx("textarea",{readOnly:!0,value:m,onFocus:$=>$.target.select(),rows:3,style:{width:"100%"}})]})]}),e.jsxs("div",{className:"runner-status",style:{display:"flex",gap:16,alignItems:"center",margin:"4px 0 8px"},children:[e.jsxs("span",{children:[e.jsx("b",{children:"Job:"})," ",a?`#${a}`:"—"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Status:"})," ",(i==null?void 0:i.status)||(a?"queued":"—")]}),e.jsxs("span",{children:[e.jsx("b",{children:"Runner:"})," ",(i==null?void 0:i.runner_id)||"—"]}),((N=i==null?void 0:i.error)==null?void 0:N.message)&&e.jsxs("span",{style:{color:"crimson"},children:[e.jsx("b",{children:"Error:"})," ",i.error.message]}),e.jsx("span",{className:"spacer",style:{flex:1}}),e.jsxs("button",{className:"btn",onClick:l,title:"Enqueue Workflow",children:[e.jsx("i",{className:"fa fa-play"})," Run"]}),e.jsxs("button",{className:"btn",onClick:g?u:p,disabled:!a||w,title:g?"Resume":"Pause",children:[e.jsx("i",{className:`fa fa-${g?"play":"pause"}`})," ",g?"Resume":"Pause"]}),e.jsxs("button",{className:"btn",onClick:y,disabled:!a||w,title:"Cancel",children:[e.jsx("i",{className:"fa fa-stop"})," Stop"]})]}),e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"}})]})}),e.jsx("div",{id:"ystudio-panel-drag",ref:x,title:"Resize panel"})]})}function qe({onClose:a,onLoggedIn:i}){const[r,m]=f.useState("login"),[l,p]=f.useState({username:"",email:"",password:""}),[u,y]=f.useState("");async function h({username:w,password:N}){try{const L=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:w,password:N})})).json();if(L!=null&&L.token)return localStorage.setItem("yolandi_token",L.token),i(),!0}catch{}return!1}async function x({email:w,username:N,password:$}){try{const W=await(await fetch("https://yolandi.org/wp-json/yolandi-shop/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w,username:N,password:$})})).json();if(W!=null&&W.token)return localStorage.setItem("yolandi_token",W.token),i(),!0}catch{}return!1}async function g(){(r==="login"?await h({username:l.username,password:l.password}):await x({email:l.email,username:l.username,password:l.password}))||y("Authentication failed")}return e.jsx("div",{className:"auth-mask",children:e.jsxs("div",{className:"auth-modal",children:[e.jsxs("div",{className:"head",children:[e.jsx("b",{children:"Sign in to YOLANDI.org"}),e.jsx("button",{onClick:a,children:e.jsx("i",{className:"fa fa-xmark"})})]}),e.jsxs("div",{className:"body",children:[r==="register"&&e.jsxs("label",{children:["Email ",e.jsx("input",{type:"email",value:l.email,onChange:w=>p({...l,email:w.target.value})})]}),e.jsxs("label",{children:["Username ",e.jsx("input",{value:l.username,onChange:w=>p({...l,username:w.target.value})})]}),e.jsxs("label",{children:["Password ",e.jsx("input",{type:"password",value:l.password,onChange:w=>p({...l,password:w.target.value})})]}),u&&e.jsx("div",{className:"err",children:u})]}),e.jsxs("div",{className:"foot",children:[e.jsx("button",{onClick:g,className:"primary",children:r==="login"?"Login":"Create Account"}),e.jsx("button",{onClick:()=>m(r==="login"?"register":"login"),className:"ghost",children:r==="login"?"Create an account":"Back to login"}),e.jsx("div",{className:"grow"}),e.jsx("button",{onClick:()=>{var w,N;(N=(w=window.YOLANDI)==null?void 0:w.devBypass)==null||N.call(w),i()},className:"ghost",title:"Developer bypass",children:"Bypass"})]})]})})}function He({initialPath:a=null,fsLs:i,onConfirm:r,onClose:m}){const[l,p]=f.useState({loading:!0,cwd:"",dirs:[],files:[],filename:"workflow.json",canUp:!1}),[u,y]=f.useState(""),h=async(x=null)=>{y(""),p(g=>({...g,loading:!0}));try{const g=await i(x||a||null);p({loading:!1,cwd:g.cwd,dirs:g.dirs||[],files:g.files||[],filename:"workflow.json",canUp:!!g.canUp})}catch(g){y(g.message||String(g)),p(w=>({...w,loading:!1}))}};return f.useEffect(()=>{h()},[]),e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{width:720,maxHeight:"80vh",background:"#151515",border:"1px solid #333",borderRadius:12,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid #2a2a2a",display:"flex",alignItems:"center",gap:10},children:[e.jsx("strong",{children:"Save workflow as…"}),e.jsx("div",{style:{marginLeft:"auto"}}),e.jsxs("button",{className:"btn",onClick:m,children:[e.jsx("i",{className:"fa fa-xmark"})," Close"]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:"1px solid #1f1f1f",display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("button",{className:"btn",disabled:!l.canUp,onClick:()=>h(l.cwd+"/.."),children:[e.jsx("i",{className:"fa fa-level-up-alt"})," Up"]}),e.jsx("div",{style:{fontFamily:"ui-monospace, Menlo, Consolas, monospace",fontSize:12,opacity:.9},children:l.cwd||"(loading…)"})]}),e.jsxs("div",{style:{display:"flex",gap:10,padding:12},children:[e.jsxs("div",{style:{flex:"0 0 45%",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Folders"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[l.loading?e.jsx("div",{style:{padding:12,opacity:.7},children:"Loading…"}):l.dirs.map(x=>e.jsxs("div",{className:"row",onDoubleClick:()=>h(x.path),style:{padding:"8px 12px",cursor:"pointer"},children:[e.jsx("i",{className:"fa fa-folder",style:{marginRight:8}})," ",x.name]},x.path)),!l.loading&&!l.dirs.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No subfolders"})]})]}),e.jsxs("div",{style:{flex:"1 1 auto",border:"1px solid #2a2a2a",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{padding:8,borderBottom:"1px solid #222",background:"#1a1a1a"},children:e.jsx("strong",{children:"Files"})}),e.jsxs("div",{style:{maxHeight:320,overflow:"auto"},children:[l.files.map(x=>e.jsxs("div",{className:"row",onClick:()=>p(g=>({...g,filename:x.name})),style:{padding:"8px 12px",cursor:"pointer",display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("i",{className:"fa fa-file",style:{marginRight:8}})," ",x.name]}),e.jsx("div",{style:{opacity:.6,fontSize:12},children:x.size})]},x.path)),!l.files.length&&e.jsx("div",{style:{padding:12,opacity:.7},children:"No files"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"10px 14px",borderTop:"1px solid #2a2a2a"},children:[e.jsx("label",{style:{fontSize:12,opacity:.8},children:"Filename"}),e.jsx("input",{value:l.filename,onChange:x=>p(g=>({...g,filename:x.target.value})),style:{flex:1,background:"#111",border:"1px solid #333",borderRadius:6,color:"#ddd",padding:"8px 10px",fontFamily:"ui-monospace, Menlo, Consolas, monospace"}}),e.jsxs("button",{className:"btn",onClick:()=>{const x=l.filename.endsWith(".json")?l.filename:`${l.filename}.json`;r({dirPath:l.cwd,filename:x})},children:[e.jsx("i",{className:"fa fa-save"})," Save"]})]}),u&&e.jsx("div",{style:{padding:"6px 14px",color:"#f88"},children:String(u)})]})})}function ze(){if(document.getElementById("fa-cdn"))return;const a=document.createElement("link");a.id="fa-cdn",a.rel="stylesheet",a.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css",document.head.appendChild(a)}function Ue(){const a=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",i=window.wpApiSettings&&window.wpApiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:a.replace(/\/$/,""),nonce:i}}async function Xe(){try{const l=await V(()=>import("./chunks/api-DaHWQA7t.js"),[]),p=l.getNodesManifest||l.default&&l.default.getNodesManifest;if(typeof p=="function"){const u=await p();return Array.isArray(u)?u:[]}}catch{}const{root:a,nonce:i}=Ue(),r=await fetch(`${a}/yolandi/v1/nodes`,{credentials:"same-origin",headers:i?{"X-WP-Nonce":i}:{}});if(!r.ok)throw new Error(`Nodes fetch failed: ${r.status}`);const m=await r.json();return Array.isArray(m)?m:[]}function Oe(){const a=window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/",i=window.wpApiSettings&&window.wp.apiSettings.nonce||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.nonce||null;return{root:a.replace(/\/$/,""),nonce:i}}function te(){const{root:a}=Oe();return`${a}/yolandi/v1`}function ue(){const{nonce:a}=Oe();return a?{"Content-Type":"application/json","X-WP-Nonce":a}:{"Content-Type":"application/json"}}async function Ve(a,{settings:i={},env:r={},scriptSlug:m="workflow",scriptVersion:l="1"}={}){const p=await fetch(`${te()}/jobs/enqueue`,{method:"POST",headers:ue(),credentials:"same-origin",body:JSON.stringify({script_slug:m,script_version:l,payload:{mode:"workflow",workflow:a,settings:i,env:r}})});if(!p.ok)throw new Error(`enqueue ${p.status}`);return p.json()}async function Ge(a){const i=await fetch(`${te()}/jobs/${a}`,{headers:ue(),credentials:"same-origin"});if(!i.ok)throw new Error(`get job ${i.status}`);return i.json()}async function je(a,i){const r=await fetch(`${te()}/jobs/${a}/control`,{method:"POST",headers:ue(),credentials:"same-origin",body:JSON.stringify({control:i})});if(!r.ok)throw new Error(`control ${r.status}`);return r.json().catch(()=>({}))}async function Ke(a){const i=await fetch(`${te()}/jobs/${a}/cancel`,{method:"POST",headers:ue(),credentials:"same-origin"});if(!i.ok)throw new Error(`cancel ${i.status}`);return i.json().catch(()=>({}))}function Ze({runnerId:a,nodesDir:i,runnerPath:r}={}){const m=te(),l=a||`runner-${Math.random().toString(36).slice(2)}`,p=i||"/wp-content/plugins/yolandi/nodes",u=r||"/wp-content/plugins/yolandi/runner/pause-aware-runner.js",y=[`$env:YOLANDI_API="${m}"`,`$env:YOLANDI_NODES_DIR="${p}"`,`$env:YOLANDI_RUNNER_ID="${l}"`,`node "${u}"`].join(" ; "),h=[`YOLANDI_API='${m}'`,`YOLANDI_NODES_DIR='${p}'`,`YOLANDI_RUNNER_ID='${l}'`,`node '${u}'`].join(" ");return{ps:y,sh:h}}function Qe(a){return(i,r="DEBUG")=>{const m=document.querySelector(a);if(!m)return;const l=new Date().toLocaleTimeString();m.textContent+=`${m.textContent?`
`:""}[${l}] ${r} — ${i}`,m.parentElement.scrollTop=m.parentElement.scrollHeight}}function et(a){return i=>{const r=document.querySelector(a);if(!r)return;const m=new Date().toLocaleTimeString();r.textContent+=`${r.textContent?`
`:""}[${m}] ${i}`,r.parentElement.scrollTop=r.parentElement.scrollHeight}}function tt(){const[a,i]=f.useState([]),[r,m]=f.useState(!0),[l,p]=f.useState("puppeteer"),[u,y]=f.useState([{id:"w1",title:"Workflow 1",dirty:!1}]),[h,x]=f.useState("w1"),[g,w]=f.useState({open:!1,json:null}),[N,$]=f.useState(!1),[L,W]=f.useState(()=>{const n=localStorage.getItem("yolandi_token"),c=document.cookie.includes("yolandi_bypass=1");return{token:n,user:null,bypass:c,locked:!n&&!c}}),[R,D]=f.useState(null),[k,M]=f.useState(null),[Y,G]=f.useState(""),[Z,pe]=f.useState(""),[U,ne]=f.useState(100),J=f.useRef(null),P=Qe("#ystudio-terminal pre"),z=et("#ystudio-runner pre"),se=f.useRef(""),oe=f.useRef("w1"),B=f.useRef(Object.create(null));f.useEffect(()=>{ze()},[]),f.useEffect(()=>{(async()=>{try{const n=await Xe();i(n)}catch(n){P(`Failed to load nodes: ${(n==null?void 0:n.message)||n}`,"ERROR")}})()},[]),f.useEffect(()=>{const{ps:n,sh:c}=Ze({});G(n),pe(c)},[]),f.useEffect(()=>{if(!R)return;let n=!1;const c=async()=>{try{const d=await Ge(R);M(d);const v=(d==null?void 0:d.status)||"queued";v!==se.current&&(z(`Job #${R} → ${v}`),se.current=v)}catch(d){z(`Poll error: ${d.message}`)}finally{n||setTimeout(c,2e3)}};return c(),()=>{n=!0}},[R]),f.useEffect(()=>{const n={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)},c=d=>d.map(v=>{try{return typeof v=="string"?v:JSON.stringify(v)}catch{return String(v)}}).join(" ");return console.log=(...d)=>{P(c(d),"INFO"),n.log(...d)},console.warn=(...d)=>{P(c(d),"WARN"),n.warn(...d)},console.error=(...d)=>{P(c(d),"ERROR"),n.error(...d)},()=>{console.log=n.log,console.warn=n.warn,console.error=n.error}},[]),f.useEffect(()=>{window.YOLANDI=window.YOLANDI||{},window.YOLANDI.log=P,window.YOLANDI.runnerLog=z,window.YOLANDI.actions=window.YOLANDI.actions||{},window.YOLANDI.actions.onNodeDrop=(n,c)=>{var d;if(L.locked){$(!0);return}(d=J.current)==null||d.addNodeByMeta(n,c)},window.YOLANDI.actions.onFileSave=S,window.YOLANDI.actions.onFileSaveAs=O,window.YOLANDI.devBypass=()=>{document.cookie="yolandi_bypass=1; max-age=86400; path=/",W(n=>({...n,bypass:!0,locked:!1}))}},[L.locked]),f.useEffect(()=>{const n=c=>{c.ctrlKey&&c.key.toLowerCase()==="s"&&(c.preventDefault(),c.shiftKey?O():S())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)}),f.useEffect(()=>{let n=null;const c=()=>{var v,C;const d=(C=(v=J.current)==null?void 0:v.getZoom)==null?void 0:C.call(v);typeof d=="number"&&isFinite(d)&&ne(Math.round(d*100)),n=setTimeout(c,400)};return c(),()=>n&&clearTimeout(n)},[]);function X(){var n;return((n=J.current)==null?void 0:n.exportJSON())||{nodes:[],links:[]}}function Q(n){var c;(c=J.current)==null||c.importJSON(n||{nodes:[],links:[]})}f.useEffect(()=>{var c;const n=oe.current;if(n&&n!==h){try{const v=X();B.current[n]={...B.current[n]||{},data:v}}catch(v){P(`Save active tab before switch failed: ${v.message}`,"WARN")}const d=((c=B.current[h])==null?void 0:c.data)||{nodes:[],links:[]};Q(d)}oe.current=h},[h]),f.useEffect(()=>{var v,C;const n=J.current,c=()=>y(q=>q.map(H=>H.id===h?{...H,dirty:!0}:H));let d=null;return(v=n==null?void 0:n.onDirty)!=null&&v.subscribe?d=n.onDirty.subscribe(c):(C=n==null?void 0:n.onChange)!=null&&C.subscribe?d=n.onChange.subscribe(c):n!=null&&n.on&&(n.on("change",c),d=()=>{var q;return(q=n.off)==null?void 0:q.call(n,"change",c)}),()=>{typeof d=="function"&&d()}},[h]);async function ie(){try{const n=X(),{id:c}=await Ve(n,{settings:{},env:{}});D(c),z(`Enqueued job #${c}`)}catch(n){z(`Enqueue failed: ${n.message}`),alert(`Enqueue failed: ${n.message}`)}}async function ae(){if(R)try{await je(R,"pause"),z(`Pause requested for #${R}`)}catch(n){alert(n.message)}}async function re(){if(R)try{await je(R,"resume"),z(`Resume requested for #${R}`)}catch(n){alert(n.message)}}async function le(){if(R)try{await Ke(R),z(`Cancel requested for #${R}`)}catch(n){alert(n.message)}}const ee=(k==null?void 0:k.status)==="paused",s=["succeeded","failed","canceled"].includes((k==null?void 0:k.status)||""),t=!!R&&!ee&&!s;function o(n,c){var q;const d=String(n).replace(/^\/+/,"");let v=(((q=window==null?void 0:window.wpApiSettings)==null?void 0:q.root)||"").toString(),C;if(v&&/^https?:\/\//i.test(v)?C=new URL(v.replace(/\/+$/,"/")+d):C=new URL("/wp-json/"+d,window.location.origin),c)for(const[H,ce]of Object.entries(c))ce!=null&&C.searchParams.set(H,ce);return C.toString()}async function j(n=null){const c=o("yolandi/v1/fs/ls",n?{path:n}:void 0),d=await fetch(c,{credentials:"include"});if(!d.ok)throw d.status===404?new Error("fs/ls 404 (install yolandi/v1/fs/ls route)"):new Error(`fs/ls HTTP ${d.status}`);return d.json()}async function b({path:n,name:c,json:d}){const v=o("yolandi/v1/fs/save"),C=await fetch(v,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,name:c,json:d})});if(!C.ok)throw C.status===404?new Error("fs/save 404 (install yolandi/v1/fs/save route)"):new Error(`fs/save HTTP ${C.status}`);return C.json()}async function S(){const n=X(),c=JSON.stringify(n,null,2);u.find(v=>v.id===h);const d=B.current[h]||{};if(!d.path||!d.name)return O();try{await b({path:d.path,name:d.name,json:c}),y(v=>v.map(C=>C.id===h?{...C,dirty:!1}:C)),P(`Saved: ${d.path}/${d.name}`,"INFO")}catch(v){P(`Save failed: ${v.message}`,"ERROR"),alert("Save failed: "+v.message)}}function O(){const n=JSON.stringify(X(),null,2);w({open:!0,json:n})}async function A({dirPath:n,filename:c}){try{await b({path:n,name:c,json:g.json}),B.current[h]={...B.current[h]||{},path:n,name:c},y(d=>d.map(v=>v.id===h?{...v,title:c.replace(/\.json$/i,""),dirty:!1}:v)),w({open:!1,json:null}),P(`Saved: ${n}/${c}`,"INFO")}catch(d){P(`Save As failed: ${d.message}`,"ERROR"),alert("Save As failed: "+d.message)}}function E(){const n=X()||{},c=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download=`yolandi-workflow-${Date.now()}.json`,d.click(),URL.revokeObjectURL(d.href)}function I(){document.getElementById("ystudio-import").click()}function _(n){var v;const c=(v=n.target.files)==null?void 0:v[0];if(!c)return;const d=new FileReader;d.onload=()=>{try{const C=JSON.parse(String(d.result));Q(C),y(q=>q.map(H=>H.id===h?{...H,dirty:!0}:H)),P("Workflow imported","INFO")}catch(C){P("Import failed: "+((C==null?void 0:C.message)||C),"ERROR")}},d.readAsText(c),n.target.value=""}function T(){var n,c;(c=(n=J.current)==null?void 0:n.zoomIn)==null||c.call(n)}function F(){var n,c;(c=(n=J.current)==null?void 0:n.zoomOut)==null||c.call(n)}function K(){var n,c;(c=(n=J.current)==null?void 0:n.zoomFit)==null||c.call(n)}return e.jsxs("div",{id:"ystudio","data-palette":r?"open":"closed",children:[e.jsx("input",{id:"ystudio-import",type:"file",accept:"application/json",onChange:_,style:{display:"none"}}),e.jsx(Ye,{isRunning:t,isPaused:ee,isTerminal:s,onPlayPause:()=>!R||s?ie():ee?re():ae(),onStop:le,onExport:E,onImport:I,log:P}),e.jsxs("div",{id:"ystudio-main",style:{paddingBottom:28},children:[e.jsx(Fe,{activePanel:l,setActivePanel:p,paletteOpen:r,setPaletteOpen:m,manifest:a,log:P,auth:L}),e.jsxs("div",{id:"ystudio-editor",children:[e.jsxs("div",{className:"tabs",children:[u.map(n=>e.jsxs("div",{className:`tab ${n.id===h?"active":""}`,onClick:()=>x(n.id),children:[e.jsxs("span",{className:"name",children:[n.title,n.dirty?"*":""]}),e.jsx("button",{className:"close",onClick:c=>{if(c.stopPropagation(),n.id===h){const v=X();B.current[n.id]={...B.current[n.id]||{},data:v}}y(v=>v.filter(C=>C.id!==n.id));const d=B.current;d[n.id]&&delete d[n.id],setTimeout(()=>{if(!document.querySelector(".tabs .tab")){const v="w"+Math.random().toString(36).slice(2,7);y([{id:v,title:"Untitled",dirty:!1}]),x(v),B.current[v]={data:{nodes:[],links:[]},path:null,name:null},Q({nodes:[],links:[]})}},0)},children:e.jsx("i",{className:"fa fa-xmark"})})]},n.id)),e.jsx("button",{className:"tab add",onClick:()=>{const n="w"+Math.random().toString(36).slice(2,7);y(c=>[...c,{id:n,title:"Untitled",dirty:!0}]),B.current[n]={data:{nodes:[],links:[]},path:null,name:null},x(n)},title:"New Workflow",children:e.jsx("i",{className:"fa fa-plus"})})]}),e.jsxs("div",{id:"ystudio-editor-host",style:{position:"relative",flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"canvas-wrap",style:{position:"relative",flex:"1 1 auto",minHeight:0},children:[e.jsx(Pe,{registerApi:n=>J.current=n}),e.jsxs("div",{style:{position:"absolute",top:10,right:10,display:"flex",gap:8,zIndex:20},children:[e.jsx("button",{className:"btn",title:"Zoom Out",onClick:F,children:e.jsx("i",{className:"fa fa-magnifying-glass-minus"})}),e.jsxs("div",{className:"btn",title:"Zoom",children:[U,"%"]}),e.jsx("button",{className:"btn",title:"Zoom In",onClick:T,children:e.jsx("i",{className:"fa fa-magnifying-glass-plus"})}),e.jsx("button",{className:"btn",title:"Fit",onClick:K,children:e.jsx("i",{className:"fa fa-compress"})})]})]}),e.jsx(Be,{jobId:R,job:k,runnerCmdPS:Y,runnerCmdSH:Z,onPlay:ie,onPause:ae,onResume:re,onCancel:le})]})]})]}),N&&e.jsx(qe,{onClose:()=>$(!1),onLoggedIn:()=>$(!1)}),g.open&&e.jsx(He,{initialPath:null,fsLs:j,onClose:()=>w({open:!1,json:null}),onConfirm:A}),e.jsxs("div",{id:"ystudio-statusbar",style:{position:"fixed",left:0,right:0,bottom:0,zIndex:30},children:[e.jsxs("div",{className:"left",children:[e.jsx("i",{className:"fa fa-code-branch"})," main ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-circle"})," Ready"]}),e.jsxs("div",{className:"right",children:[e.jsx("i",{className:"fa fa-gauge-high"})," Job: ",R?(k==null?void 0:k.status)||"queued":"idle"," ",e.jsx("span",{className:"sep"})," ",e.jsx("i",{className:"fa fa-rotate"})," Auto-save"]})]})]})}const nt=[{key:"scripts",label:"Scripts",Component:_e},{key:"jobs",label:"Jobs",Component:Te},{key:"nodes",label:"Nodes",Component:Me},{key:"graph",label:"Graph",Component:tt}];self.MonacoEnvironment||(self.MonacoEnvironment={getWorker(a,i){switch(i){case"json":return new ke;case"css":return new Se;case"html":return new Ne;case"typescript":case"javascript":return new be;default:return new ve}}});function st(){const{active:a}=Re(nt,"scripts"),i=(a==null?void 0:a.Component)||(()=>e.jsx("div",{}));return e.jsxs("div",{style:{padding:12},children:[e.jsx("h1",{children:"YOLANDI Admin"}),e.jsx(i,{})]})}(function(){const i=document.getElementById("yolandi-root");if(!i)return;Ce.createRoot(i).render(e.jsx(st,{}))})();
