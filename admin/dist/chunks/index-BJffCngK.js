const $=window.React||window.wp&&window.wp.element,{useEffect:L,useState:y}=$,E={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function v(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function A(){if(document.getElementById("yolandi-workflows-css"))return;const t=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,a=document.createElement("style");a.id="yolandi-workflows-css",a.textContent=t,document.head.appendChild(a)}function P({open:t}){return wp.element.createElement("span",{className:`inline-block transition-transform duration-150 mr-1 ${t?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"}},"â–¶")}function N({node:t,baseKey:a,depth:w,expanded:p,onToggle:m,onOpen:i}){const d=8+w*12;if(t.type==="dir"){const f=t.rel||t.name,u=!!p[f];return wp.element.createElement("div",null,wp.element.createElement("div",{className:"yol-tree__row",style:{paddingLeft:d},onClick:()=>m(f),title:t.rel||t.name},wp.element.createElement(P,{open:u}),wp.element.createElement("strong",null,t.name)),u&&(t.children||[]).map(c=>{var g;return wp.element.createElement(N,{key:`${c.type}-${(g=c.rel)!=null?g:c.name}`,node:c,baseKey:a,depth:w+1,expanded:p,onToggle:m,onOpen:i})}))}return wp.element.createElement("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:d+16},onClick:()=>i(a,t),title:t.rel||t.name},wp.element.createElement("span",{style:{marginRight:6}},"ðŸ“„"),wp.element.createElement("span",null,t.name))}function I(){function t(){A();const[a,w]=y([]),[p,m]=y(!0),[i,d]=y(""),[f,u]=y(""),[c,g]=y(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}});function S(e){g(n=>{const o=typeof e=="function"?e(n):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(o))}catch{}return o})}function C(e){S(n=>({...n,[e]:!n[e]}))}L(()=>{(async()=>{m(!0),d("");try{const e=v(),n=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.json();w(Array.isArray(o)?o:[])}catch{d("Workflows API unavailable"),w([])}finally{m(!1)}})()},[]);async function T(e,n){var o,r;try{const s=v(),_=new URL(`${s}/yolandi/v1/workflow`,window.location.origin);_.searchParams.set("baseKey",e),_.searchParams.set("rel",n.rel);const h=await fetch(_.toString(),{credentials:"same-origin"}),l=await h.json();if(!h.ok||l!=null&&l.error)throw new Error((l==null?void 0:l.error)||`HTTP ${h.status}`);const x={baseKey:e,rel:l.rel,name:l.name,content:String((o=l.content)!=null?o:""),mtime:l.mtime||null};window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:x})),document.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:x,bubbles:!0,composed:!0})),(r=window.YOLANDI)!=null&&r.openWorkflowTab&&window.YOLANDI.openWorkflowTab(x)}catch(s){alert(`Failed to open workflow: ${s.message}`),console.error(s)}}const k=f.trim().toLowerCase(),b=k?a.map(e=>{const n=r=>r.toLowerCase().includes(k);function o(r){if(r.type==="file")return n(r.name)?r:null;const s=(r.children||[]).map(o).filter(Boolean);return s.length||n(r.name)?{...r,children:s}:null}return{...e,tree:(e.tree||[]).map(o).filter(Boolean)}}):a;return wp.element.createElement("div",{className:"yol-wfs"},wp.element.createElement("div",{className:"yol-wfs__hdr"},wp.element.createElement("div",{className:"yol-wfs__title"},"Workflows"),p?wp.element.createElement("div",{style:{fontSize:12,opacity:.7}},"Loadingâ€¦"):null),wp.element.createElement("div",{className:"yol-wfs__search"},wp.element.createElement("input",{type:"search",placeholder:"Search workflowsâ€¦",value:f,onChange:e=>u(e.target.value)})),wp.element.createElement("div",{className:"yol-wfs__tree"},i&&wp.element.createElement("div",{style:{color:"#f66",margin:"8px 10px"}},i),b.length===0&&!p&&!i&&wp.element.createElement("div",{className:"yol-empty"},"No workflows yet."),b.map(e=>wp.element.createElement("div",{key:e.baseKey,className:"yol-wfs__section"},wp.element.createElement("div",{className:"yol-wfs__sectionTitle"},e.label),(e.tree||[]).map(n=>{var o;return wp.element.createElement(N,{key:`${n.type}-${(o=n.rel)!=null?o:n.name}`,node:n,baseKey:e.baseKey,depth:0,expanded:c,onToggle:C,onOpen:T})})))))}return{id:E.id,title:E.title,icon:E.icon,render:()=>wp.element.createElement(t,null)}}export{I as create,E as meta};
