function f(){let t=window.YOLANDI_BOOT&&window.YOLANDI_BOOT.restBase||"";if(!t){const n=document.querySelector('link[rel="https://api.w.org"]');n!=null&&n.href&&(t=n.href.replace(/\/$/,"")+"/yolandi/v1")}return t||(t="/wp-json/yolandi/v1"),t.replace(/\/$/,"")}async function d(t,n={}){const e={credentials:"omit",...n,headers:{"Content-Type":"application/json"}};e.body&&typeof e.body!="string"&&!(e.body instanceof FormData)&&(e.body=JSON.stringify(e.body));const s=await fetch(t,e),o=await s.text(),r=(s.headers.get("content-type")||"").includes("application/json"),l=r?o?JSON.parse(o):null:o;return{resp:s,isJson:r,body:l,text:o}}async function b(t,n={}){const a=f(),e=t.startsWith("/")?t:`/${t}`,s=`${a}${e}`,o={...n};o.body!=null&&typeof o.body!="string"&&!(o.body instanceof FormData)&&(o.body=JSON.stringify(o.body));let{resp:r,isJson:l,body:c}=await d(s,o);const u=typeof c=="string"&&c.trim().startsWith("<!DOCTYPE");if((!r.ok||u)&&!o.__fallbackTried){const i=`${s.replace(a,"")}`.replace(/^\//,""),p=`${window.location.origin}/index.php?rest_route=/yolandi/v1/${i}`,y=await d(p,{...o,__fallbackTried:!0});r=y.resp,l=y.isJson,c=y.body}if(!r.ok){const i=new Error(`API ${r.status} ${r.statusText}`);throw i.status=r.status,i.url=r.url,i.body=c,i}if(!l||c==null){const i=new Error("API returned non-JSON response");throw i.url=r.url,i.body=c,i}return c}async function w(t,n=15e3,a={}){const e=new AbortController,s=setTimeout(()=>e.abort(),n);try{return await b(t,{...a,signal:e.signal})}finally{clearTimeout(s)}}function g(t,n){const a=f(),e=new URL(String(a).replace(/\/$/,"")+"/"+String(t).replace(/^\//,""),window.location.origin);if(n&&typeof n=="object")for(const[s,o]of Object.entries(n))e.searchParams.set(s,String(o));return e.toString()}export{b as api,w as apiWithTimeout,f as computeRestBase,g as joinRest};
