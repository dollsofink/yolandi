import{j as r,a as i}from"./vendor-react-Bifdz3QC.js";const j={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function v(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function E(){if(document.getElementById("yolandi-workflows-css"))return;const s=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,n=document.createElement("style");n.id="yolandi-workflows-css",n.textContent=s,document.head.appendChild(n)}function $({open:s}){return r.jsx("span",{className:`inline-block transition-transform duration-150 mr-1 ${s?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"},children:"â–¶"})}function S({node:s,baseKey:n,depth:p,expanded:f,toggle:w,onOpen:c}){const y=8+p*12;if(s.type==="dir"){const m=s.rel||s.name,u=!!f[m];return r.jsxs("div",{children:[r.jsxs("div",{className:"yol-tree__row",style:{paddingLeft:y},onClick:()=>w(m),title:s.rel||s.name,children:[r.jsx($,{open:u}),r.jsx("strong",{children:s.name})]}),u&&(s.children||[]).map(d=>{var x;return r.jsx(S,{node:d,baseKey:n,depth:p+1,expanded:f,toggle:w,onOpen:c},`${d.type}-${(x=d.rel)!=null?x:d.name}`)})]})}return r.jsxs("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:y+16},onClick:()=>c(n,s),title:s.rel||s.name,children:[r.jsx("span",{style:{marginRight:6},children:"ðŸ“„"}),r.jsx("span",{children:s.name})]})}function L(){function s(){E();const[n,p]=i.useState([]),[f,w]=i.useState(!0),[c,y]=i.useState(""),[m,u]=i.useState(""),[d,x]=i.useState(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}}),k=i.useCallback(e=>{x(o=>{const t=typeof e=="function"?e(o):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(t))}catch{}return t})},[]),N=i.useCallback(e=>k(o=>({...o,[e]:!o[e]})),[k]);i.useEffect(()=>{(async()=>{w(!0),y("");try{const e=v(),o=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const t=await o.json();p(Array.isArray(t)?t:[])}catch{y("Workflows API unavailable"),p([])}finally{w(!1)}})()},[]);const C=i.useCallback(async(e,o)=>{var t;try{const a=v(),g=new URL(`${a}/yolandi/v1/workflow`,window.location.origin);g.searchParams.set("baseKey",e),g.searchParams.set("rel",o.rel);const _=await fetch(g.toString(),{credentials:"same-origin"}),l=await _.json();if(!_.ok||l!=null&&l.error)throw new Error((l==null?void 0:l.error)||`HTTP ${_.status}`);window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:{baseKey:e,rel:l.rel,name:l.name,content:String((t=l.content)!=null?t:""),mtime:l.mtime||null}}))}catch(a){alert(`Failed to open workflow: ${a.message}`),console.error(a)}},[]),h=m.trim().toLowerCase(),b=i.useMemo(()=>{if(!h)return n;const e=t=>t.toLowerCase().includes(h),o=t=>{if(t.type==="file")return e(t.name)?t:null;const a=(t.children||[]).map(o).filter(Boolean);return a.length||e(t.name)?{...t,children:a}:null};return n.map(t=>({...t,tree:(t.tree||[]).map(o).filter(Boolean)}))},[n,h]);return r.jsxs("div",{className:"yol-wfs",children:[r.jsxs("div",{className:"yol-wfs__hdr",children:[r.jsx("div",{className:"yol-wfs__title",children:"Workflows"}),f?r.jsx("div",{style:{fontSize:12,opacity:.7},children:"Loadingâ€¦"}):null]}),r.jsx("div",{className:"yol-wfs__search",children:r.jsx("input",{type:"search",placeholder:"Search workflowsâ€¦",value:m,onChange:e=>u(e.target.value)})}),r.jsxs("div",{className:"yol-wfs__tree",children:[c&&r.jsx("div",{style:{color:"#f66",margin:"8px 10px"},children:c}),b.length===0&&!f&&!c&&r.jsx("div",{className:"yol-empty",children:"No workflows yet."}),b.map(e=>r.jsxs("div",{className:"yol-wfs__section",children:[r.jsx("div",{className:"yol-wfs__sectionTitle",children:e.label}),(e.tree||[]).map(o=>{var t;return r.jsx(S,{node:o,baseKey:e.baseKey,depth:0,expanded:d,toggle:N,onOpen:C},`${o.type}-${(t=o.rel)!=null?t:o.name}`)})]},e.baseKey))]})]})}return{id:j.id,title:j.title,icon:j.icon,render:()=>r.jsx(s,{})}}export{L as create,j as meta};
