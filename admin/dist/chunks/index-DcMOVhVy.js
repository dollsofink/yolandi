const t=window.React||window.wp&&window.wp.element,{useEffect:L,useState:u}=t,k={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function N(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function A(){if(document.getElementById("yolandi-workflows-css"))return;const n=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,s=document.createElement("style");s.id="yolandi-workflows-css",s.textContent=n,document.head.appendChild(s)}function P({open:n}){return t.createElement("span",{className:`inline-block transition-transform duration-150 mr-1 ${n?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"}},"â–¶")}function S({node:n,baseKey:s,depth:p,expanded:d,onToggle:f,onOpen:c}){const m=8+p*12;if(n.type==="dir"){const y=n.rel||n.name,g=!!d[y];return t.createElement("div",null,t.createElement("div",{className:"yol-tree__row",style:{paddingLeft:m},onClick:()=>f(y),title:n.rel||n.name},t.createElement(P,{open:g}),t.createElement("strong",null,n.name)),g&&(n.children||[]).map(w=>{var _;return t.createElement(S,{key:`${w.type}-${(_=w.rel)!=null?_:w.name}`,node:w,baseKey:s,depth:p+1,expanded:d,onToggle:f,onOpen:c})}))}return t.createElement("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:m+16},onClick:()=>c(s,n),title:n.rel||n.name},t.createElement("span",{style:{marginRight:6}},"ðŸ“„"),t.createElement("span",null,n.name))}function I(){function n(){A();const[s,p]=u([]),[d,f]=u(!0),[c,m]=u(""),[y,g]=u(""),[w,_]=u(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}});function C(e){_(o=>{const r=typeof e=="function"?e(o):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(r))}catch{}return r})}function T(e){C(o=>({...o,[e]:!o[e]}))}L(()=>{(async()=>{f(!0),m("");try{const e=N(),o=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const r=await o.json();p(Array.isArray(r)?r:[])}catch{m("Workflows API unavailable"),p([])}finally{f(!1)}})()},[]);async function $(e,o){var r,l;try{const i=N(),h=new URL(`${i}/yolandi/v1/workflow`,window.location.origin);h.searchParams.set("baseKey",e),h.searchParams.set("rel",o.rel);const x=await fetch(h.toString(),{credentials:"same-origin"}),a=await x.json();if(!x.ok||a!=null&&a.error)throw new Error((a==null?void 0:a.error)||`HTTP ${x.status}`);const E={baseKey:e,rel:a.rel,name:a.name,content:String((r=a.content)!=null?r:""),mtime:a.mtime||null};window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:E})),document.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:E,bubbles:!0,composed:!0})),(l=window.YOLANDI)!=null&&l.openWorkflowTab&&window.YOLANDI.openWorkflowTab(E)}catch(i){alert(`Failed to open workflow: ${i.message}`),console.error(i)}}const b=y.trim().toLowerCase(),v=b?s.map(e=>{const o=l=>l.toLowerCase().includes(b);function r(l){if(l.type==="file")return o(l.name)?l:null;const i=(l.children||[]).map(r).filter(Boolean);return i.length||o(l.name)?{...l,children:i}:null}return{...e,tree:(e.tree||[]).map(r).filter(Boolean)}}):s;return t.createElement("div",{className:"yol-wfs"},t.createElement("div",{className:"yol-wfs__hdr"},t.createElement("div",{className:"yol-wfs__title"},"Workflows"),d?t.createElement("div",{style:{fontSize:12,opacity:.7}},"Loadingâ€¦"):null),t.createElement("div",{className:"yol-wfs__search"},t.createElement("input",{type:"search",placeholder:"Search workflowsâ€¦",value:y,onChange:e=>g(e.target.value)})),t.createElement("div",{className:"yol-wfs__tree"},c&&t.createElement("div",{style:{color:"#f66",margin:"8px 10px"}},c),v.length===0&&!d&&!c&&t.createElement("div",{className:"yol-empty"},"No workflows yet."),v.map(e=>t.createElement("div",{key:e.baseKey,className:"yol-wfs__section"},t.createElement("div",{className:"yol-wfs__sectionTitle"},e.label),(e.tree||[]).map(o=>{var r;return t.createElement(S,{key:`${o.type}-${(r=o.rel)!=null?r:o.name}`,node:o,baseKey:e.baseKey,depth:0,expanded:w,onToggle:T,onOpen:$})})))))}return{id:k.id,title:k.title,icon:k.icon,render:()=>t.createElement(n,null)}}export{I as create,k as meta};
