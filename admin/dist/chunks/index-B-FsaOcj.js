import{j as o}from"./vendor-react-Bifdz3QC.js";const L=window.React||window.wp&&window.wp.element,{useEffect:A,useMemo:P,useState:u,useCallback:g,Fragment:W}=L,v={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function C(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function R(){if(document.getElementById("yolandi-workflows-css"))return;const n=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,s=document.createElement("style");s.id="yolandi-workflows-css",s.textContent=n,document.head.appendChild(s)}function I({open:n}){return o.jsx("span",{className:`inline-block transition-transform duration-150 mr-1 ${n?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"},children:"â–¶"})}function T({node:n,baseKey:s,depth:p,expanded:w,toggle:f,onOpen:a}){const y=8+p*12;if(n.type==="dir"){const m=n.rel||n.name,x=!!w[m];return o.jsxs("div",{children:[o.jsxs("div",{className:"yol-tree__row",style:{paddingLeft:y},onClick:()=>f(m),title:n.rel||n.name,children:[o.jsx(I,{open:x}),o.jsx("strong",{children:n.name})]}),x&&(n.children||[]).map(c=>{var h;return o.jsx(T,{node:c,baseKey:s,depth:p+1,expanded:w,toggle:f,onOpen:a},`${c.type}-${(h=c.rel)!=null?h:c.name}`)})]})}return o.jsxs("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:y+16},onClick:()=>a(s,n),title:n.rel||n.name,children:[o.jsx("span",{style:{marginRight:6},children:"ðŸ“„"}),o.jsx("span",{children:n.name})]})}function z(){function n(){R();const[s,p]=u([]),[w,f]=u(!0),[a,y]=u(""),[m,x]=u(""),[c,h]=u(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}}),N=g(e=>{h(r=>{const t=typeof e=="function"?e(r):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(t))}catch{}return t})},[]),$=g(e=>N(r=>({...r,[e]:!r[e]})),[N]);A(()=>{(async()=>{f(!0),y("");try{const e=C(),r=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!r.ok)throw new Error(`HTTP ${r.status}`);const t=await r.json();p(Array.isArray(t)?t:[])}catch{y("Workflows API unavailable"),p([])}finally{f(!1)}})()},[]);const S=g(async(e,r)=>{var t,l;try{const d=C(),j=new URL(`${d}/yolandi/v1/workflow`,window.location.origin);j.searchParams.set("baseKey",e),j.searchParams.set("rel",r.rel);const k=await fetch(j.toString(),{credentials:"same-origin"}),i=await k.json();if(!k.ok||i!=null&&i.error)throw new Error((i==null?void 0:i.error)||`HTTP ${k.status}`);const b={baseKey:e,rel:i.rel,name:i.name,content:String((t=i.content)!=null?t:""),mtime:i.mtime||null};window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:b})),document.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:b,bubbles:!0,composed:!0})),(l=window.YOLANDI)!=null&&l.openWorkflowTab&&window.YOLANDI.openWorkflowTab(b)}catch(d){alert(`Failed to open workflow: ${d.message}`),console.error(d)}},[]),_=m.trim().toLowerCase(),E=P(()=>{if(!_)return s;const e=t=>t.toLowerCase().includes(_),r=t=>{if(t.type==="file")return e(t.name)?t:null;const l=(t.children||[]).map(r).filter(Boolean);return l.length||e(t.name)?{...t,children:l}:null};return s.map(t=>({...t,tree:(t.tree||[]).map(r).filter(Boolean)}))},[s,_]);return o.jsxs("div",{className:"yol-wfs",children:[o.jsxs("div",{className:"yol-wfs__hdr",children:[o.jsx("div",{className:"yol-wfs__title",children:"Workflows"}),w?o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Loadingâ€¦"}):null]}),o.jsx("div",{className:"yol-wfs__search",children:o.jsx("input",{type:"search",placeholder:"Search workflowsâ€¦",value:m,onChange:e=>x(e.target.value)})}),o.jsxs("div",{className:"yol-wfs__tree",children:[a&&o.jsx("div",{style:{color:"#f66",margin:"8px 10px"},children:a}),E.length===0&&!w&&!a&&o.jsx("div",{className:"yol-empty",children:"No workflows yet."}),E.map(e=>o.jsxs("div",{className:"yol-wfs__section",children:[o.jsx("div",{className:"yol-wfs__sectionTitle",children:e.label}),(e.tree||[]).map(r=>{var t;return o.jsx(T,{node:r,baseKey:e.baseKey,depth:0,expanded:c,toggle:$,onOpen:g((l,d)=>S(l,d),[S])},`${r.type}-${(t=r.rel)!=null?t:r.name}`)})]},e.baseKey))]})]})}return{id:v.id,title:v.title,icon:v.icon,render:()=>o.jsx(n,{})}}export{z as create,v as meta};
