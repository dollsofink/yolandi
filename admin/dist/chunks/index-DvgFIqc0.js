import{j as t}from"./vendor-react-Bifdz3QC.js";const $=window.React||window.wp&&window.wp.element,{useEffect:L,useState:u}=$,k={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function N(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function A(){if(document.getElementById("yolandi-workflows-css"))return;const o=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,l=document.createElement("style");l.id="yolandi-workflows-css",l.textContent=o,document.head.appendChild(l)}function P({open:o}){return t.jsx("span",{className:`inline-block transition-transform duration-150 mr-1 ${o?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"},children:"â–¶"})}function S({node:o,baseKey:l,depth:p,expanded:w,onToggle:f,onOpen:c}){const y=8+p*12;if(o.type==="dir"){const m=o.rel||o.name,x=!!w[m];return t.jsxs("div",{children:[t.jsxs("div",{className:"yol-tree__row",style:{paddingLeft:y},onClick:()=>f(m),title:o.rel||o.name,children:[t.jsx(P,{open:x}),t.jsx("strong",{children:o.name})]}),x&&(o.children||[]).map(d=>{var h;return t.jsx(S,{node:d,baseKey:l,depth:p+1,expanded:w,onToggle:f,onOpen:c},`${d.type}-${(h=d.rel)!=null?h:d.name}`)})]})}return t.jsxs("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:y+16},onClick:()=>c(l,o),title:o.rel||o.name,children:[t.jsx("span",{style:{marginRight:6},children:"ðŸ“„"}),t.jsx("span",{children:o.name})]})}function I(){function o(){A();const[l,p]=u([]),[w,f]=u(!0),[c,y]=u(""),[m,x]=u(""),[d,h]=u(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}});function E(e){h(n=>{const r=typeof e=="function"?e(n):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(r))}catch{}return r})}function C(e){E(n=>({...n,[e]:!n[e]}))}L(()=>{(async()=>{f(!0),y("");try{const e=N(),n=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const r=await n.json();p(Array.isArray(r)?r:[])}catch{y("Workflows API unavailable"),p([])}finally{f(!1)}})()},[]);async function T(e,n){var r,s;try{const a=N(),g=new URL(`${a}/yolandi/v1/workflow`,window.location.origin);g.searchParams.set("baseKey",e),g.searchParams.set("rel",n.rel);const _=await fetch(g.toString(),{credentials:"same-origin"}),i=await _.json();if(!_.ok||i!=null&&i.error)throw new Error((i==null?void 0:i.error)||`HTTP ${_.status}`);const j={baseKey:e,rel:i.rel,name:i.name,content:String((r=i.content)!=null?r:""),mtime:i.mtime||null};window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:j})),document.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:j,bubbles:!0,composed:!0})),(s=window.YOLANDI)!=null&&s.openWorkflowTab&&window.YOLANDI.openWorkflowTab(j)}catch(a){alert(`Failed to open workflow: ${a.message}`),console.error(a)}}const b=m.trim().toLowerCase(),v=b?l.map(e=>{const n=s=>s.toLowerCase().includes(b);function r(s){if(s.type==="file")return n(s.name)?s:null;const a=(s.children||[]).map(r).filter(Boolean);return a.length||n(s.name)?{...s,children:a}:null}return{...e,tree:(e.tree||[]).map(r).filter(Boolean)}}):l;return t.jsxs("div",{className:"yol-wfs",children:[t.jsxs("div",{className:"yol-wfs__hdr",children:[t.jsx("div",{className:"yol-wfs__title",children:"Workflows"}),w?t.jsx("div",{style:{fontSize:12,opacity:.7},children:"Loadingâ€¦"}):null]}),t.jsx("div",{className:"yol-wfs__search",children:t.jsx("input",{type:"search",placeholder:"Search workflowsâ€¦",value:m,onChange:e=>x(e.target.value)})}),t.jsxs("div",{className:"yol-wfs__tree",children:[c&&t.jsx("div",{style:{color:"#f66",margin:"8px 10px"},children:c}),v.length===0&&!w&&!c&&t.jsx("div",{className:"yol-empty",children:"No workflows yet."}),v.map(e=>t.jsxs("div",{className:"yol-wfs__section",children:[t.jsx("div",{className:"yol-wfs__sectionTitle",children:e.label}),(e.tree||[]).map(n=>{var r;return t.jsx(S,{node:n,baseKey:e.baseKey,depth:0,expanded:d,onToggle:C,onOpen:T},`${n.type}-${(r=n.rel)!=null?r:n.name}`)})]},e.baseKey))]})]})}return{id:k.id,title:k.title,icon:k.icon,render:()=>t.jsx(o,{})}}export{I as create,k as meta};
